(function(b){b.fn.picturezoom=function(a){var d=b.extend({align:"left",thumb_image_width:310,thumb_image_height:310,source_image_width:1024,source_image_height:768,zoom_area_width:600,zoom_area_height:"justify",zoom_area_distance:10,zoom_easing:true,click_to_zoom:false,zoom_element:"auto",show_descriptions:true,description_location:"bottom",description_opacity:0.7,small_thumbs:3,smallthumb_inactive_opacity:0.4,smallthumb_hide_single:true,smallthumb_select_on_hover:false,smallthumbs_position:"bottom",show_begin_end_smallthumb:true,magnifier_opacity:0.5,magnifier_invert:true,show_icon:true,icon_offset:20,hide_cursor:false,show_hint:false,hint_offset:15,speed:600,autoplay:true,autoplay_interval:6000,keyboard:true,right_to_left:false,click_callback:function(){return true},change_callback:function(){return true}},a);b.each(this,function(){var cr=b(this);if(cr.is("ul")&&cr.children("li").length&&cr.find("img.picturezoom_source_image").length){var b4,b6,bs,bA,bR,a4,bg,cf,cm,bH,cg=cr.attr("id"),b8=Math.floor(d.speed*0.7),cv=Math.round(d.speed/100),bZ=false,i=0,bh=false,bT=true,bP=false,a0=0,bW=0,bX=0,bk=0,bl=0,cs="hori";if(typeof cg==="undefined"||!cg){cg="[no id]"}if(d.smallthumbs_position==="left"||d.smallthumbs_position==="right"){cs="vert"}if(typeof b.browser==="object"&&b.browser.msie){if(b.browser.version<9){bT=false;if(b.browser.version<7){bh=true}}}cr.addClass("picturezoom").show();var a1=cr.children("li").addClass("picturezoom_thumb");a1.first().show().addClass("picturezoom_thumb_active");var a7=a1.length,co=d.autoplay;if(a7<2){co=false}if(d.align==="right"){cr.addClass("picturezoom_right")}b.each(a1,function(f){f+=1;var h=b(this),g=h.find(".picturezoom_thumb_image").removeAttr("alt").show(),k=h.find(".picturezoom_source_image"),e=h.find("a");h.data("id",f).addClass("thumb_"+f);if(!g.length&&k.length){h.prepend('<img class="picturezoom_thumb_image" src="'+k.attr("src")+'" />')}else{if(!g.length&&!k.length){h.remove()}}if(e.length){h.find(".picturezoom_thumb_image").data("anchor",e.attr("href"))}});var bJ=a1.find(".picturezoom_thumb_image").css({width:d.thumb_image_width,height:d.thumb_image_height}).show();b.each(bJ,function(){b(this).data("src",this.src)});var cj=b('<li class="picturezoom_magnifier"><div><img /></div></li>').appendTo(cr),b7=cj.children("div"),be=b7.children("img");var bI=b('<li class="picturezoom_icon">&nbsp;</li>').appendTo(cr);if(d.show_icon){bI.show()}var a6;if(d.show_hint){a6=b('<li class="picturezoom_hint">&nbsp;</li>').appendTo(cr).show()}var by,a5=d.zoom_element;if(a5!=="auto"&&a5&&b(a5).length){by=b(a5).addClass("picturezoom_zoom_area").html('<div><img class="picturezoom_zoom_img" /></div>')}else{a5="auto";by=b('<li class="picturezoom_zoom_area"><div><img class="picturezoom_zoom_img" /></div></li>').appendTo(cr)}var bm=by.children("div"),bU;if(bT){bU=b('<img class="picturezoom_zoom_preview" />').css({width:d.source_image_width,height:d.source_image_height,opacity:0.3}).prependTo(bm).show()}var cw=bm.children(".picturezoom_zoom_img").css({width:d.source_image_width,height:d.source_image_height});var bB;if(d.show_descriptions){bB=b('<div class="picturezoom_description'+((d.right_to_left)?" rtl":"")+'"></div>').prependTo(by)}var ch,bc,cc,a3,j,bY=d.small_thumbs;if(a7>1||!d.smallthumb_hide_single){ch=b('<li class="picturezoom_small_thumbs"><ul></ul></li>').appendTo(cr);bc=ch.children("ul");b.each(bJ,function(){var e=b(this);bs=e.data("src");bA=e.parents(".picturezoom_thumb").data("id");b('<li><img class="picturezoom_small_thumb" src="'+bs+'" /></li>').data("thumb_id",bA).appendTo(bc)});cc=bc.children("li").css({opacity:d.smallthumb_inactive_opacity});if(bY<3){bY=3}if(a7>bY){if(d.show_begin_end_smallthumb){bs=bJ.eq(a7-1).data("src");bA=a1.eq(a7-1).data("id");b('<li class="picturezoom_smallthumb_first picturezoom_smallthumb_navtoend"><img class="picturezoom_small_thumb" src="'+bs+'" /></li>').data("src",bs).data("thumb_id",bA).css({opacity:d.smallthumb_inactive_opacity}).prependTo(bc);bs=bJ.eq(0).data("src");bA=a1.eq(0).data("id");b('<li class="picturezoom_smallthumb_navtostart"><img class="picturezoom_small_thumb" src="'+bs+'" /></li>').data("src",bs).data("thumb_id",bA).css({opacity:d.smallthumb_inactive_opacity}).appendTo(bc);cc=bc.children("li");cc.eq(1).addClass("picturezoom_smallthumb_active").css({opacity:1})}else{cc.eq(0).addClass("picturezoom_smallthumb_first picturezoom_smallthumb_active").css({opacity:1})}cc.eq(bY-1).addClass("picturezoom_smallthumb_last")}else{cc.eq(0).addClass("picturezoom_smallthumb_active").css({opacity:1})}b.each(cc,function(e){b(this).data("id",(e+1))});a3=cc.children("img");j=cc.length;if(cs==="vert"){cc.addClass("vertical")}}if(d.magnifier_invert){bR=1}else{bR=d.magnifier_opacity}var ck=parseInt(a1.css("borderLeftWidth"),10)+parseInt(a1.css("borderRightWidth"),10)+parseInt(bJ.css("borderLeftWidth"),10)+parseInt(bJ.css("borderRightWidth"),10),bj=parseInt(a1.css("marginLeft"),10)+parseInt(a1.css("marginRight"),10),bO=parseInt(a1.css("paddingLeft"),10)+parseInt(a1.css("paddingRight"),10)+parseInt(bJ.css("marginLeft"),10)+parseInt(bJ.css("marginRight"),10)+parseInt(bJ.css("paddingLeft"),10)+parseInt(bJ.css("paddingRight"),10),bv=d.thumb_image_width+ck+bj+bO,bu=d.thumb_image_height+ck+bj+bO,ct=0,bt=0,bF=0,b1=0,cu=0,a9=0,cq=0;if(a7>1||!d.smallthumb_hide_single){ct=parseInt(cc.css("borderLeftWidth"),10)+parseInt(cc.css("borderRightWidth"),10)+parseInt(a3.css("borderLeftWidth"),10)+parseInt(a3.css("borderRightWidth"),10);bt=parseInt(cc.css("marginTop"),10);bF=parseInt(cc.css("paddingLeft"),10)+parseInt(cc.css("paddingRight"),10)+parseInt(a3.css("marginLeft"),10)+parseInt(a3.css("marginRight"),10)+parseInt(a3.css("paddingLeft"),10)+parseInt(a3.css("paddingRight"),10);if(cs==="vert"){cu=Math.round((bu-((bY-1)*bt))/bY)-(ct+bF);b1=Math.round((d.thumb_image_width*cu)/d.thumb_image_height);a9=b1+ct+bF;cq=cu+ct+bF}else{b1=Math.round((bv-((bY-1)*bt))/bY)-(ct+bF);cu=Math.round((d.thumb_image_height*b1)/d.thumb_image_width);a9=b1+ct+bF;cq=cu+ct+bF}}var bi=parseInt(by.css("borderTopWidth"),10),cx=parseInt(d.zoom_area_distance,10),bz=parseInt(by.css("paddingTop"),10),bp,c;if((d.zoom_area_width-(bi*2)-(bz*2))>d.source_image_width){bp=d.source_image_width}else{bp=d.zoom_area_width-(bi*2)-(bz*2)}if(d.zoom_area_height==="justify"){c=(bu+bt+cq)-(bi*2)-(bz*2)}else{c=d.zoom_area_height-(bi*2)-(bz*2)}if(c>d.source_image_height){c=d.source_image_height}var ca,bN,a2,bQ;if(d.show_descriptions){ca=parseInt(bB.css("borderLeftWidth"),10)+parseInt(bB.css("borderRightWidth"),10);bN=parseInt(bB.css("marginLeft"),10)+parseInt(bB.css("marginRight"),10);a2=parseInt(bB.css("paddingLeft"),10)+parseInt(bB.css("paddingRight"),10);bQ=bp-ca-bN-a2}var cl;if(bh){cl=b('<iframe marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="javascript:\'<html></html>\'"></iframe>').css({position:"absolute",zIndex:1}).prependTo(by)}var bq=parseInt(cj.css("borderTopWidth"),10),cn=parseInt(a1.css("borderTopWidth"),10)+parseInt(a1.css("marginTop"),10)+parseInt(a1.css("paddingTop"),10)+parseInt(bJ.css("borderTopWidth"),10)+parseInt(bJ.css("marginTop"),10)-bq,bV=bJ.offset().left-cr.offset().left-bq;if(d.smallthumbs_position==="left"){bV=bV+a9+bt}else{if(d.smallthumbs_position==="top"){cn=cn+cq+bt}}var bn=Math.round(bp*(d.thumb_image_width/d.source_image_width)),br=Math.round(c*(d.thumb_image_height/d.source_image_height)),bw=cn+d.thumb_image_height-br,a8=bV+d.thumb_image_width-bn,b2=Math.round(bn/2),b3=Math.round(br/2),bD,bM;if(d.show_hint){bD=parseInt(d.hint_offset,10)+parseInt(a6.css("marginTop"),10);bM=parseInt(d.hint_offset,10)+parseInt(a6.css("marginRight"),10);if(d.smallthumbs_position==="right"){bM=bM-a9-bt}}if(cs==="vert"){cf=bv+bt+a9;cr.css({width:cf,height:bu})}else{cf=bv;cr.css({width:cf,height:bu+bt+cq})}if(d.show_icon){bH={top:bu-bI.outerHeight(true)-parseInt(d.icon_offset,10),left:parseInt(d.icon_offset,10)};if(d.smallthumbs_position==="left"){bH.left=a9+bt+parseInt(d.icon_offset,10)}else{if(d.smallthumbs_position==="top"){bH.top+=cq+bt}}bI.css(bH)}if(d.show_hint){a6.css({margin:0,top:-bD,right:-bM})}be.css({margin:0,padding:0,width:d.thumb_image_width,height:d.thumb_image_height});b7.css({margin:0,padding:0,width:bn,height:br});bH={margin:0,padding:0,left:(a8-bV)/2,top:(bw-cn)/2};if(d.smallthumbs_position==="left"){bH.left="+="+a9+bt}else{if(d.smallthumbs_position==="top"){bH.top="+="+cq+bt}}cj.css(bH).hide();bm.css({width:bp,height:c});bH={margin:0,opacity:0};if(d.align==="right"&&a5==="auto"){bH.left=-(bp+(bi*2)+(bz*2)+cx)}else{if(a5==="auto"){bH.left=cf+cx}}by.css(bH).hide();if(d.show_descriptions){bH={width:bQ,bottom:bz,left:bz,opacity:d.description_opacity};if(d.description_location==="top"){bH.top=bz;bH.bottom="auto"}bB.css(bH).hide()}if(a7>1||!d.smallthumb_hide_single){if(cs==="vert"){bH={top:0,height:bu};if(d.smallthumbs_position==="left"){a1.css({left:a9+bt})}else{bH.marginLeft=bv+bt}ch.css(bH);bc.css({height:(cq*j)+(j*bt)+100});a3.css({width:b1,height:cu}).attr("height",cu);cc.css({margin:0,marginBottom:bt})}else{bH={width:bv};if(d.smallthumbs_position==="top"){a1.css({top:cq+bt})}else{bH.top=bu+bt}ch.css(bH);bc.css({width:(a9*j)+(j*bt)+100});a3.css({width:b1,height:cu}).attr("width",b1);cc.css({margin:0,marginRight:bt})}if(cs==="vert"){cm=((cq*bY)+((bY-1)*bt))-bu}else{cm=((a9*bY)+((bY-1)*bt))-bv}if(cm>0){for(b4=1;b4<=(j-1);b4=b4+(bY-1)){b6=1;for(b6;b6<=cm;b6+=1){if(cs==="vert"){cc.eq(b4+b6-1).css({marginBottom:(bt-1)})}else{cc.eq(b4+b6-1).css({marginRight:(bt-1)})}}}}else{if(cm<0){for(b4=1;b4<=(j-1);b4=b4+(bY-1)){b6=1;for(b6;b6<=(-cm);b6+=1){if(cs==="vert"){cc.eq(b4+b6-1).css({marginBottom:(bt+1)});bc.css({height:parseInt(bc.css("height"),10)+1})}else{cc.eq(b4+b6-1).css({marginRight:(bt+1)});bc.css({width:parseInt(bc.css("width"),10)+1})}}}}}}if(d.show_icon&&!d.magnifier_invert){cj.css({background:cj.css("background-color")+" "+bI.css("background-image")+" center no-repeat"})}if(d.hide_cursor){cj.add(bI).css({cursor:"none"})}if(bh){cl.css({width:bm.css("width"),height:bm.css("height")})}var bC=a1.first().find(".picturezoom_thumb_image"),bS=a1.first().find(".picturezoom_source_image");if(d.magnifier_invert){be.attr("src",bC.data("src")).show()}if(bT){bU.attr("src",bC.data("src"))}cw.attr("src",bS.attr("src"));if(d.show_descriptions){bg=bS.attr("title");if(bg){bB.html(bg).show()}}var bL=function(){if(a4){clearInterval(a4);a4=false}};var bd=function(){if(a4){bL()}a4=setInterval(function(){bK()},d.autoplay_interval)};var bo=function(){cj.stop().fadeTo(b8,bR);bI.stop().animate({opacity:0},b8);by.stop().show().animate({opacity:1},b8);if(d.magnifier_invert){bC.stop().animate({opacity:d.magnifier_opacity},b8)}if(co){bL()}};var cb=function(){cj.stop().fadeOut(d.speed);bI.stop().animate({opacity:1},d.speed);by.stop().animate({opacity:0},d.speed,function(){b(this).hide()});if(d.magnifier_invert){bC.stop().animate({opacity:1},d.speed,function(){if(d.click_to_zoom){bP=false}})}clearTimeout(a0);if(co){bd()}};var bf=function(k,f){var g,e,h=cr.find(".picturezoom_smallthumb_active").removeClass("picturezoom_smallthumb_active");k.addClass("picturezoom_smallthumb_active");cj.stop().hide();by.stop().hide();if(!f){bZ=true;h.stop(true,true).animate({opacity:d.smallthumb_inactive_opacity},b8);k.stop(true,true).animate({opacity:1},b8,function(){bZ=false})}cr.find(".picturezoom_thumb_active").removeClass("picturezoom_thumb_active").stop().animate({opacity:0},d.speed,function(){b(this).hide()});g=a1.filter(".thumb_"+k.data("thumb_id")).addClass("picturezoom_thumb_active").show().stop().css({opacity:0}).animate({opacity:1},d.speed);bC=g.find(".picturezoom_thumb_image");bS=g.find(".picturezoom_source_image");if(d.magnifier_invert){be.attr("src",bC.data("src"))}if(bT){bU.attr("src",bC.data("src"))}cw.attr("src",bS.attr("src"));if(d.show_descriptions){bg=bS.attr("title");if(bg){bB.html(bg).show()}else{bB.hide()}}if(co){bL();bd()}e=k.data("id");if(a7>=bY){e--}b0(e)};var bE=function(e,g,h,f){b.each(cc,function(){var k=b(this),l={opacity:d.smallthumb_inactive_opacity};if(k.data("id")===f.data("id")){l.opacity=1}if(cs==="vert"){l.top="-="+e}else{l.left="-="+e}k.animate(l,b8,"swing",function(){if(bZ){f.addClass("picturezoom_smallthumb_active");bZ=false}})});bf(f,true)};var b9=function(){var e=bk-bW,f=bl-bX,g=-e/cv,h=-f/cv;bW=bW-g;bX=bX-h;if(e<1&&e>-1){bW=bk}if(f<1&&f>-1){bX=bl}cw.css({left:bW,top:bX});if(bT){bU.css({left:bW,top:bX})}if(e>1||f>1||e<1||f<1){a0=setTimeout(function(){b9()},25)}};var bx=function(){var e;if(d.magnifier_invert){cr.find(".picturezoom_thumb_active").mouseleave()}if(!d.right_to_left){e=cr.find(".picturezoom_smallthumb_active").prev();if(!e.length){if(a7>bY){bG()}else{cc.last().trigger("click")}return true}}else{e=cr.find(".picturezoom_smallthumb_active").next();if(!e.length){if(a7>bY){b5()}else{cc.first().trigger("click")}return true}}e.trigger("click")};var bK=function(){var e;if(d.magnifier_invert){cr.find(".picturezoom_thumb_active").mouseleave()}if(!d.right_to_left){e=cr.find(".picturezoom_smallthumb_active").next();if(!e.length){if(a7>bY){b5()}else{cc.first().trigger("click")}return true}}else{e=cr.find(".picturezoom_smallthumb_active").prev();if(!e.length){if(a7>bY){bG()}else{cc.last().trigger("click")}return true}}e.trigger("click")};var ba=function(f){if(a7<=bY||!d.show_begin_end_smallthumb){f=f-1}var m=cc.eq(f);if(m.length&&!bZ){var n=cr.find(".picturezoom_smallthumb_active"),g=n.data("id")-1,h;if(g>f){i=g-f;var e=cr.find(".picturezoom_smallthumb_first"),l=e.data("id");if(f<l){h=g-l;i=i-h;e.trigger("click")}else{bf(m,false)}}else{if(g<f){i=f-g;var o=cr.find(".picturezoom_smallthumb_last"),k=o.data("id")-1;if(f>=k){h=k-g-1;i=i-h;o.trigger("click")}else{bf(m,false)}}}}};window[cg+"_previous"]=function(){bx()};window[cg+"_next"]=function(){bK()};window[cg+"_show"]=function(e){ba(e)};var cp=function(e){if(!d.click_callback(e,cg)){return false}if(typeof picturezoom_click_callback==="function"){picturezoom_click_callback(e,cg);return false}return true};var b0=function(e){if(d.change_callback(e,cg)){if(typeof picturezoom_change_callback==="function"){picturezoom_change_callback(e,cg)}}};a1.add(cj).add(bI).mouseenter(function(){if(d.show_hint){a6.hide()}if(!d.click_to_zoom||bP){bo()}}).mouseleave(function(){cb()});var cd=-(d.source_image_width-bp),ce=-(d.source_image_height-c);a1.add(cj).add(bI).mousemove(function(k){var g=Math.round(k.pageX-bC.offset().left+bV),h=Math.round(k.pageY-bC.offset().top+cn);var l=(g-b2),m=(h-b3);if(l<bV){l=bV}if(l>a8){l=a8}if(m<cn){m=cn}if(m>bw){m=bw}cj.css({left:l,top:m});if(d.magnifier_invert){var e=l-bV,f=m-cn;be.css({left:-e,top:-f})}bk=-((l-bV)*(1/(d.thumb_image_width/d.source_image_width)));bl=-((m-cn)*(1/(d.thumb_image_height/d.source_image_height)));if(bk<cd){bk=cd}if(bl<ce){bl=ce}if(d.zoom_easing){clearTimeout(a0);b9()}else{if(bT){bU.css({left:bk,top:bl})}cw.css({left:bk,top:bl})}});function ci(e){i=(i)?i-1:0;bZ=true;var f=cr.find(".picturezoom_smallthumb_first").removeClass("picturezoom_smallthumb_first");var h=cr.find(".picturezoom_smallthumb_last").removeClass("picturezoom_smallthumb_last");var m,g,k,l;if(e==="left"){m=f.prev().addClass("picturezoom_smallthumb_first");g=h.prev().addClass("picturezoom_smallthumb_last");k=f}else{m=f.next().addClass("picturezoom_smallthumb_first");g=h.next().addClass("picturezoom_smallthumb_last");k=h}if(i){if(e==="left"){m.trigger("click")}else{g.trigger("click")}}else{l=(cs==="vert")?m.position().top:m.position().left;bE(l,m,g,k)}}function bb(k){bZ=true;var f=cr.find(".picturezoom_smallthumb_first").removeClass("picturezoom_smallthumb_first");var h=cr.find(".picturezoom_smallthumb_last").removeClass("picturezoom_smallthumb_last");var e,g,l;if(k==="end"){e=cc.eq(j-bY).addClass("picturezoom_smallthumb_first");g=cc.eq(j-1).addClass("picturezoom_smallthumb_last");l=g;if(g.hasClass("picturezoom_smallthumb_navtostart")){l=g.prev()}}else{e=cc.eq(0).addClass("picturezoom_smallthumb_first");g=cc.eq(bY-1).addClass("picturezoom_smallthumb_last");l=e;if(e.hasClass("picturezoom_smallthumb_navtoend")){l=e.next()}}var m=(cs==="vert")?e.position().top:e.position().left;bE(m,e,g,l)}function b5(){bb("start")}function bG(){bb("end")}if(a7>1||!d.smallthumb_hide_single){cc.click(function(){var l=b(this),e,h=0,n=false,f,k,o,m,g;if(!l.hasClass("picturezoom_smallthumb_active")&&(!bZ||i)){if(l.hasClass("picturezoom_smallthumb_first")&&l.prev().length){ci("left")}else{if(l.hasClass("picturezoom_smallthumb_navtoend")){bG()}else{if(l.hasClass("picturezoom_smallthumb_last")&&l.next().length){ci("right")}else{if(l.hasClass("picturezoom_smallthumb_navtostart")){b5()}else{if(i&&!b(this).next().length){bG();return true}else{if(i&&!b(this).prev().length){b5();return true}}bf(l,false)}}}}}});if(d.smallthumb_select_on_hover){cc.mouseenter(function(){b(this).trigger("click")})}}if(d.click_to_zoom){a1.click(function(){bP=true;bo()})}else{cj.click(function(){var e=bC.data("anchor");if(e){if(cp(e)){window.location=e}}})}if(a7>1&&d.keyboard){b(document).keydown(function(e){if(e.keyCode===39||e.keyCode==="39"){if(!d.right_to_left){bK()}else{bx()}}if(e.keyCode===37||e.keyCode==="37"){if(!d.right_to_left){bx()}else{bK()}}})}b(window).bind("load",function(){a1.css({"background-image":"none"});by.css({"background-image":"none"});if(bT){bT=false;bU.remove()}});if(co){bd()}}});return this}})(jQuery);