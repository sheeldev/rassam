var myimgmap,props,outputmode,imgroot;function gui_toggleMore(){var a=$("#more_actions").parent().find(".toggler");$("#more_actions").css({top:$(a).offset().top+($(a).outerHeight()),left:$(a).offset().left});$("#more_actions").slideToggle(200,function(){if($(this).css("display")=="none"){$(a).addClass("toggler_off")}else{$(a).removeClass("toggler_off")}})}function gui_colorChanged(a){myimgmap.pic_container.style.backgroundColor=a.value;gui_toggleMore()}function gui_row_mouseover(b){if(myimgmap.is_drawing){return}if(myimgmap.viewmode===1){return}var a=(myimgmap.isMSIE)?window.event.srcElement:b.currentTarget;if(typeof a.aid=="undefined"){a=a.parentNode}myimgmap.highlightArea(a.aid)}function gui_row_mouseout(b){if(myimgmap.is_drawing){return}if(myimgmap.viewmode===1){return}var a=(myimgmap.isMSIE)?window.event.srcElement:b.currentTarget;if(typeof a.aid=="undefined"){a=a.parentNode}myimgmap.blurArea(a.aid)}function gui_row_click(b){if(myimgmap.viewmode===1){return}var a=(myimgmap.isMSIE)?window.event.srcElement:b.currentTarget;if(typeof a.aid=="undefined"){a=a.parentNode}gui_row_select(a.aid,false,false);myimgmap.currentid=a.aid}function gui_row_select(d,c,a){if(myimgmap.is_drawing){return}if(myimgmap.viewmode===1){return}if(!document.getElementById("img_active_"+d)){return}gui_cb_unselect_all();document.getElementById("img_active_"+d).checked=1;if(c){document.getElementById("img_active_"+d).focus()}for(var b=0;b<props.length;b++){if(props[b]){props[b].style.background=""}}props[d].style.background="#e7e7e7"}function gui_cb_keydown(b){if(myimgmap.viewmode===1){return}var a=(myimgmap.isMSIE)?event.keyCode:b.keyCode;if(a==46){myimgmap.removeArea(myimgmap.currentid)}}function gui_cb_unselect_all(){for(var a=0;a<props.length;a++){if(props[a]){document.getElementById("img_active_"+a).checked=false}}}function gui_coords_keydown(k){return;if(myimgmap.viewmode===1){return}var d=event.keyCode;var h=window.event.srcElement;if(d==40||d==38){var g=h.value.split(",");var f=getSelectionStart(h);var a=0;for(var c=0,b=g.length;c<b;c++){a+=g[c].length;if(a>f){if(d==40&&g[c]>0){g[c]--}if(d==38){g[c]++}break}a++}h.value=g.join(",");if(h.value!=myimgmap.areas[h.parentNode.aid].lastInput){myimgmap._recalculate(h.parentNode.aid,h.value)}setSelectionRange(h,f);return true}}function getSelectionStart(b){if(b.createTextRange){var a=document.selection.createRange().duplicate();a.moveEnd("character",b.value.length);if(a.text===""){return b.value.length}return b.value.lastIndexOf(a.text)}else{return b.selectionStart}}function setSelectionRange(c,d,a){if(typeof a=="undefined"){a=d}if(c.setSelectionRange){c.focus();c.setSelectionRange(d,a)}else{if(c.createTextRange){var b=c.createTextRange();b.collapse(true);b.moveEnd("character",a);b.moveStart("character",d);b.select()}}}function gui_input_change(c){if(myimgmap.viewmode===1){return}if(myimgmap.is_drawing){return}var b=(myimgmap.isMSIE)?window.event.srcElement:c.currentTarget;if(b.name=="img_href"){var d=b.parentNode.parentNode.aid;myimgmap.areas[d].ahref=b.value}else{if(b.name=="img_alt"){var d=b.parentNode.parentNode.aid;myimgmap.areas[d].aalt=b.value}else{if(b.name=="img_title"){var d=b.parentNode.parentNode.aid;myimgmap.areas[d].atitle=b.value}else{if(b.name=="img_target"){var d=b.parentNode.parentNode.parentNode.aid;myimgmap.areas[d].atarget=b.value}else{if(b.name=="img_shape"){var d=b.parentNode.parentNode.parentNode.aid;if(myimgmap.areas[d].shape!=b.value&&myimgmap.areas[d].shape!="undefined"){var a="";if(props[d]){a=props[d].getElementsByTagName("input")[2].value}else{a=myimgmap.areas[d].lastInput||""}a=myimgmap._normCoords(a,b.value,"from"+myimgmap.areas[d].shape);if(props[d]){props[d].getElementsByTagName("input")[2].value=a}myimgmap.areas[d].shape=b.value;myimgmap._recalculate(d,a);myimgmap.areas[d].lastInput=a}else{if(myimgmap.areas[d].shape=="undefined"){myimgmap.nextShape=b.value}}}}}}}if(myimgmap.areas[d]&&myimgmap.areas[d].shape!="undefined"){myimgmap._recalculate(d,props[d].getElementsByTagName("input")[2].value);myimgmap.fireEvent("onHtmlChanged",myimgmap.getMapHTML())}}function gui_addArea(b){props[b]=document.createElement("tr");document.getElementById("form_container").appendChild(props[b]);props[b].id="img_area_"+b;props[b].aid=b;props[b].className="img_area";myimgmap.addEvent(props[b],"mouseover",gui_row_mouseover);myimgmap.addEvent(props[b],"mouseout",gui_row_mouseout);myimgmap.addEvent(props[b],"click",gui_row_click);var a='<td width="14.28%"><input type="text" name="img_id" class="img_id" value="'+b+'" readonly="1" style="width:41px;text-align:center" /></td>';a+='<td width="14.28%"><input type="radio" name="img_active" class="img_active" id="img_active_'+b+'" value="'+b+'"></td>';a+='<td width="14.28%"><div class="draw-select__wrapper draw-input--has-content"><select name="img_shape" class="img_shape draw-select">';a+='<option value="rect">Rectangle</option>';if(document.getElementById("dd_output").value!="css"){a+='<option value="circle">Circle</option>';a+='<option value="poly">Polygon</option>';a+='<option value="bezier1">Bezier</option>'}a+="</select></div></td>";a+='<td width="14.28%"><input type="text" name="img_coords" class="img_coords draw-input" placeholder="Coordinates"></td>';a+='<td width="14.28%"><input type="text" name="img_href" class="img_href draw-input" placeholder="URL"></td>';a+='<td width="14.28%"><input type="text" name="img_alt" class="img_alt draw-input" placeholder="Alternative text"></td>';a+='<td width="14.28%"><div class="draw-select__wrapper draw-input--has-content"><select name="img_target" class="img_target draw-select">';a+='<option value="">&lt;not set&gt;</option>';a+='<option value="_self">this window</option>';a+='<option value="_blank">new window</option>';a+='<option value="_top">top window</option>';a+="</select></div></td>";props[b].innerHTML=a;myimgmap.addEvent(props[b].getElementsByTagName("input")[1],"keydown",gui_cb_keydown);myimgmap.addEvent(props[b].getElementsByTagName("input")[2],"keydown",gui_coords_keydown);myimgmap.addEvent(props[b].getElementsByTagName("input")[2],"change",gui_input_change);myimgmap.addEvent(props[b].getElementsByTagName("input")[3],"change",gui_input_change);myimgmap.addEvent(props[b].getElementsByTagName("input")[4],"change",gui_input_change);myimgmap.addEvent(props[b].getElementsByTagName("select")[0],"change",gui_input_change);myimgmap.addEvent(props[b].getElementsByTagName("select")[1],"change",gui_input_change);if(myimgmap.isSafari){myimgmap.addEvent(props[b].getElementsByTagName("select")[0],"change",gui_row_click);myimgmap.addEvent(props[b].getElementsByTagName("select")[1],"change",gui_row_click)}if(myimgmap.nextShape){props[b].getElementsByTagName("select")[0].value=myimgmap.nextShape}gui_row_select(b,true)}function gui_removeArea(d){if(props[d]){var a=props[d].parentNode;var c=a.lastChild.aid;a.removeChild(props[d]);props[d]=null;try{gui_row_select(c,true);myimgmap.currentid=c}catch(b){}}}function gui_modeChanged(c){var a,b;if(c==1){if(document.getElementById("html_container")){document.getElementById("html_container").disabled=true}a=document.getElementById("form_container").getElementsByTagName("input");for(b=0;b<a.length;b++){a[b].disabled=true}a=document.getElementById("form_container").getElementsByTagName("select");for(b=0;b<a.length;b++){a[b].disabled=true}document.getElementById("i_preview").src=imgroot+"edit.gif";document.getElementById("dd_zoom").disabled=true;document.getElementById("dd_output").disabled=true}else{if(document.getElementById("html_container")){document.getElementById("html_container").disabled=false}a=document.getElementById("form_container").getElementsByTagName("input");for(b=0;b<a.length;b++){a[b].disabled=false}a=document.getElementById("form_container").getElementsByTagName("select");for(b=0;b<a.length;b++){a[b].disabled=false}document.getElementById("i_preview").src=imgroot+"zoom.gif";document.getElementById("dd_zoom").disabled=false;document.getElementById("dd_output").disabled=false}}function gui_htmlChanged(b){var a=document.getElementById("dd_output").value;if(document.getElementById("html_container")){document.getElementById("html_container").value=b}}function gui_statusMessage(a){if(document.getElementById("status_container")){document.getElementById("status_container").innerHTML=a}window.defaultStatus=a}function gui_areaChanged(a){var b=a.aid;if(props[b]){if(a.shape){props[b].getElementsByTagName("select")[0].value=a.shape}if(a.lastInput){props[b].getElementsByTagName("input")[2].value=a.lastInput}if(a.ahref){props[b].getElementsByTagName("input")[3].value=a.ahref}if(a.aalt){props[b].getElementsByTagName("input")[4].value=a.aalt}if(a.atarget){props[b].getElementsByTagName("select")[1].value=a.atarget}}}function gui_htmlBlur(){var a=document.getElementById("html_container");var b=a.getAttribute("oldvalue");if(b!=a.value&&document.getElementById("dd_output").value=="imagemap"){myimgmap.setMapHTML(a.value)}}function gui_htmlFocus(){var a=document.getElementById("html_container");a.setAttribute("oldvalue",a.value);a.select()}function gui_htmlShow(){toggleFieldset(document.getElementById("fieldset_html"),1);document.getElementById("html_container").focus()}function changelabeling(a){myimgmap.config.label=a.value;myimgmap._repaintAll()}function toggleBoundingBox(a){a.checked=!a.checked;a.innerHTML="&nbsp; bounding box";if(a.checked){a.innerHTML="&raquo; bounding box"}myimgmap.config.bounding_box=a.checked;myimgmap.relaxAllAreas();gui_toggleMore()}function toggleFieldset(a,b){if(a){if(a.className=="fieldset_off"||b==1){a.className=""}else{a.className="fieldset_off"}}}function gui_selectArea(a){gui_row_select(a.aid,true,false)}function gui_zoom(){var b=document.getElementById("dd_zoom").value;var a=document.getElementById("pic_container").getElementsByTagName("img")[0];if(typeof a=="undefined"){return false}if(typeof a.oldwidth=="undefined"||!a.oldwidth){a.oldwidth=a.width}if(typeof a.oldheight=="undefined"||!a.oldheight){a.oldheight=a.height}a.width=a.oldwidth*b;a.height=a.oldheight*b;myimgmap.scaleAllAreas(b)}function print_hero_picture_info(c,b,a){xmldata=new AJAX_Handler(true);xmldata.src=urlencode(c);xmldata.mode=urlencode(b);xmldata.folder=urlencode(a);xmldata.id=urlencode(fetch_js_object("source_url3_id").value);xmldata.cid=urlencode(fetch_js_object("source_url3_cid").value);xmldata.onreadystatechange(function(){if(xmldata.handler.readyState==4&&xmldata.handler.status==200){if(xmldata.handler.responseText!=""){var d;d=xmldata.handler.responseText.split("|");if(xmldata.mode=="load"){myimgmap.loadImage(iL.IMGUPLOADSCDN+xmldata.folder+"/"+xmldata.src,d[4],d[5]);fetch_js_object("pic_displayorder").innerHTML='<input type="text" name="sort" id="sort" value="'+d[0]+'" class="draw-input" /><input type="hidden" name="img_width" id="img_width" value="'+d[4]+'"><input type="hidden" name="img_height" id="img_height" value="'+d[5]+'">';fetch_js_object("html_container").value=d[1];fetch_js_object("pic_categoryid").innerHTML=d[3];fetch_js_object("pic_styleid").innerHTML=d[6];if(d[4]>=1200){document.getElementById("dd_zoom").value="0.75"}else{document.getElementById("dd_zoom").value="1"}if(d[1]!=""){gui_htmlBlur()}gui_zoom()}else{if(xmldata.mode=="insert"){myimgmap.loadImage(iL.IMGUPLOADSCDN+xmldata.folder+"/"+xmldata.src,d[4],d[5]);fetch_js_object("pic_displayorder").innerHTML='<input type="text" name="sort" id="sort" value="'+(parseInt(d[0])+parseInt(10))+'" class="draw-input" /><input type="hidden" name="img_width" id="img_width" value="'+d[4]+'"><input type="hidden" name="img_height" id="img_height" value="'+d[5]+'">';fetch_js_object("html_container").value="";fetch_js_object("pic_categoryid").innerHTML=d[3];fetch_js_object("pic_styleid").innerHTML=d[6];if(d[4]>=1200){document.getElementById("dd_zoom").value="0.75"}else{document.getElementById("dd_zoom").value="1"}gui_zoom()}}}xmldata.handler.abort()}});xmldata.send(iL.AJAXURL,"do=heropicture&id="+xmldata.id+"&cid="+xmldata.cid+"&filename="+xmldata.src+"&mode="+xmldata.mode+"&folder="+xmldata.folder+"&token="+iL.TOKEN)}function gui_loadImage(d,c,b){var a=document.getElementById("pic_container").getElementsByTagName("img")[0];if(typeof a!="undefined"){a.parentNode.removeChild(a);delete myimgmap.pic}if(c=="load"){toggle_show("savebutton");toggle_hide("insertbutton")}else{if(c=="insert"){toggle_show("insertbutton");toggle_hide("savebutton")}}print_hero_picture_info(d,c,b)}function gui_outputChanged(){var b,c;var d=(window.clipboardData||typeof air=="object");var a=document.getElementById("dd_output").value;b="This is the generated image map HTML code. ";b+="Click into the textarea below and press Ctrl+C to copy the code to your clipboard. ";if(d){b+="Alternatively you can use the clipboard icon on the right. ";b+='<img src="example1_files/clipboard.gif" onclick="gui_toClipBoard()" style="float: right; margin: 4px; cursor: pointer;"/>'}b+="Please note, that you have to attach this code to your image, via the usemap property ";b+='(<a href="http://www.htmlhelp.com/reference/html40/special/map.html">read more</a>). ';myimgmap.setMapHTML(myimgmap.getMapHTML());outputmode=a;return true}function gui_toClipBoard(b){if(typeof b=="undefined"){b=document.getElementById("html_container").value}try{if(window.clipboardData){window.clipboardData.setData("Text",b)}else{if(typeof air=="object"){air.Clipboard.generalClipboard.clear();air.Clipboard.generalClipboard.setData("air:text",b,false)}}}catch(a){myimgmap.log("Unable to set clipboard data",1)}}myimgmap=new imgmap({mode:"editor",custom_callbacks:{onStatusMessage:function(a){gui_statusMessage(a)},onHtmlChanged:function(a){gui_htmlChanged(a)},onModeChanged:function(a){gui_modeChanged(a)},onAddArea:function(a){gui_addArea(a)},onRemoveArea:function(a){gui_removeArea(a)},onAreaChanged:function(a){gui_areaChanged(a)},onSelectArea:function(a){gui_selectArea(a)}},pic_container:document.getElementById("pic_container"),bounding_box:false});props=[];imgroot=iL.IMGUPLOADS+"vendor/imap/";outputmode="imgmap";gui_outputChanged();myimgmap.addEvent(document.getElementById("html_container"),"blur",gui_htmlBlur);myimgmap.addEvent(document.getElementById("html_container"),"focus",gui_htmlFocus);