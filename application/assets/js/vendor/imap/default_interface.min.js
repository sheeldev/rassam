var myimgmap,props,outputmode,imgroot;function gui_toggleMore(){var e=$("#more_actions").parent().find(".toggler");$("#more_actions").css({top:$(e).offset().top+$(e).outerHeight(),left:$(e).offset().left}),$("#more_actions").slideToggle(200,function(){"none"==$(this).css("display")?$(e).addClass("toggler_off"):$(e).removeClass("toggler_off")})}function gui_colorChanged(e){myimgmap.pic_container.style.backgroundColor=e.value,gui_toggleMore()}function gui_row_mouseover(e){if(!myimgmap.is_drawing&&1!==myimgmap.viewmode){var t=myimgmap.isMSIE?window.event.srcElement:e.currentTarget;void 0===t.aid&&(t=t.parentNode),myimgmap.highlightArea(t.aid)}}function gui_row_mouseout(e){if(!myimgmap.is_drawing&&1!==myimgmap.viewmode){var t=myimgmap.isMSIE?window.event.srcElement:e.currentTarget;void 0===t.aid&&(t=t.parentNode),myimgmap.blurArea(t.aid)}}function gui_row_click(e){if(1!==myimgmap.viewmode){var t=myimgmap.isMSIE?window.event.srcElement:e.currentTarget;void 0===t.aid&&(t=t.parentNode),gui_row_select(t.aid,!1,!1),myimgmap.currentid=t.aid}}function gui_row_select(e,t,a){if(!myimgmap.is_drawing&&1!==myimgmap.viewmode&&document.getElementById("img_active_"+e)){gui_cb_unselect_all(),document.getElementById("img_active_"+e).checked=1,t&&document.getElementById("img_active_"+e).focus();for(var i=0;i<props.length;i++)props[i]&&(props[i].style.background="");props[e].style.background="#e7e7e7"}}function gui_cb_keydown(e){1!==myimgmap.viewmode&&46==(myimgmap.isMSIE?event.keyCode:e.keyCode)&&myimgmap.removeArea(myimgmap.currentid)}function gui_cb_unselect_all(){for(var e=0;e<props.length;e++)props[e]&&(document.getElementById("img_active_"+e).checked=!1)}function gui_coords_keydown(e){}function getSelectionStart(e){if(!e.createTextRange)return e.selectionStart;var t=document.selection.createRange().duplicate();return(t.moveEnd("character",e.value.length),""===t.text)?e.value.length:e.value.lastIndexOf(t.text)}function setSelectionRange(e,t,a){if(void 0===a&&(a=t),e.setSelectionRange)e.focus(),e.setSelectionRange(t,a);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",a),i.moveStart("character",t),i.select()}}function gui_input_change(e){if(1!==myimgmap.viewmode&&!myimgmap.is_drawing){var t=myimgmap.isMSIE?window.event.srcElement:e.currentTarget;if("img_href"==t.name){var a=t.parentNode.parentNode.aid;myimgmap.areas[a].ahref=t.value}else if("img_alt"==t.name){var a=t.parentNode.parentNode.aid;myimgmap.areas[a].aalt=t.value}else if("img_title"==t.name){var a=t.parentNode.parentNode.aid;myimgmap.areas[a].atitle=t.value}else if("img_target"==t.name){var a=t.parentNode.parentNode.parentNode.aid;myimgmap.areas[a].atarget=t.value}else if("img_shape"==t.name){var a=t.parentNode.parentNode.parentNode.aid;if(myimgmap.areas[a].shape!=t.value&&"undefined"!=myimgmap.areas[a].shape){var i="";i=props[a]?props[a].getElementsByTagName("input")[2].value:myimgmap.areas[a].lastInput||"",i=myimgmap._normCoords(i,t.value,"from"+myimgmap.areas[a].shape),props[a]&&(props[a].getElementsByTagName("input")[2].value=i),myimgmap.areas[a].shape=t.value,myimgmap._recalculate(a,i),myimgmap.areas[a].lastInput=i}else"undefined"==myimgmap.areas[a].shape&&(myimgmap.nextShape=t.value)}myimgmap.areas[a]&&"undefined"!=myimgmap.areas[a].shape&&(myimgmap._recalculate(a,props[a].getElementsByTagName("input")[2].value),myimgmap.fireEvent("onHtmlChanged",myimgmap.getMapHTML()))}}function gui_addArea(e){props[e]=document.createElement("tr"),document.getElementById("form_container").appendChild(props[e]),props[e].id="img_area_"+e,props[e].aid=e,props[e].className="img_area",myimgmap.addEvent(props[e],"mouseover",gui_row_mouseover),myimgmap.addEvent(props[e],"mouseout",gui_row_mouseout),myimgmap.addEvent(props[e],"click",gui_row_click);var t='<td width="14.28%"><input type="text" name="img_id" class="img_id" value="'+e+'" readonly="1" style="width:41px;text-align:center" /></td>';t+='<td width="14.28%"><input type="radio" name="img_active" class="img_active" id="img_active_'+e+'" value="'+e+'"></td>',t+='<td width="14.28%"><div class="draw-select__wrapper draw-input--has-content"><select name="img_shape" class="img_shape draw-select">',t+='<option value="rect">Rectangle</option>',"css"!=document.getElementById("dd_output").value&&(t+='<option value="circle">Circle</option>',t+='<option value="poly">Polygon</option>',t+='<option value="bezier1">Bezier</option>'),t+="</select></div></td>",t+='<td width="14.28%"><input type="text" name="img_coords" class="img_coords draw-input" placeholder="Coordinates"></td>',t+='<td width="14.28%"><input type="text" name="img_href" class="img_href draw-input" placeholder="URL"></td>',t+='<td width="14.28%"><input type="text" name="img_alt" class="img_alt draw-input" placeholder="Alternative text"></td>',t+='<td width="14.28%"><div class="draw-select__wrapper draw-input--has-content"><select name="img_target" class="img_target draw-select">',t+='<option value="">&lt;not set&gt;</option>',t+='<option value="_self">this window</option>',t+='<option value="_blank">new window</option>',t+='<option value="_top">top window</option>',t+="</select></div></td>",props[e].innerHTML=t,myimgmap.addEvent(props[e].getElementsByTagName("input")[1],"keydown",gui_cb_keydown),myimgmap.addEvent(props[e].getElementsByTagName("input")[2],"keydown",gui_coords_keydown),myimgmap.addEvent(props[e].getElementsByTagName("input")[2],"change",gui_input_change),myimgmap.addEvent(props[e].getElementsByTagName("input")[3],"change",gui_input_change),myimgmap.addEvent(props[e].getElementsByTagName("input")[4],"change",gui_input_change),myimgmap.addEvent(props[e].getElementsByTagName("select")[0],"change",gui_input_change),myimgmap.addEvent(props[e].getElementsByTagName("select")[1],"change",gui_input_change),myimgmap.isSafari&&(myimgmap.addEvent(props[e].getElementsByTagName("select")[0],"change",gui_row_click),myimgmap.addEvent(props[e].getElementsByTagName("select")[1],"change",gui_row_click)),myimgmap.nextShape&&(props[e].getElementsByTagName("select")[0].value=myimgmap.nextShape),gui_row_select(e,!0)}function gui_removeArea(e){if(props[e]){var t=props[e].parentNode,a=t.lastChild.aid;t.removeChild(props[e]),props[e]=null;try{gui_row_select(a,!0),myimgmap.currentid=a}catch(i){}}}function gui_modeChanged(e){var t,a;if(1==e){for(document.getElementById("html_container")&&(document.getElementById("html_container").disabled=!0),t=document.getElementById("form_container").getElementsByTagName("input"),a=0;a<t.length;a++)t[a].disabled=!0;for(a=0,t=document.getElementById("form_container").getElementsByTagName("select");a<t.length;a++)t[a].disabled=!0;document.getElementById("i_preview").src=imgroot+"edit.gif",document.getElementById("dd_zoom").disabled=!0,document.getElementById("dd_output").disabled=!0}else{for(document.getElementById("html_container")&&(document.getElementById("html_container").disabled=!1),t=document.getElementById("form_container").getElementsByTagName("input"),a=0;a<t.length;a++)t[a].disabled=!1;for(a=0,t=document.getElementById("form_container").getElementsByTagName("select");a<t.length;a++)t[a].disabled=!1;document.getElementById("i_preview").src=imgroot+"zoom.gif",document.getElementById("dd_zoom").disabled=!1,document.getElementById("dd_output").disabled=!1}}function gui_htmlChanged(e){document.getElementById("dd_output").value,document.getElementById("html_container")&&(document.getElementById("html_container").value=e)}function gui_statusMessage(e){document.getElementById("status_container")&&(document.getElementById("status_container").innerHTML=e),window.defaultStatus=e}function gui_areaChanged(e){var t=e.aid;props[t]&&(e.shape&&(props[t].getElementsByTagName("select")[0].value=e.shape),e.lastInput&&(props[t].getElementsByTagName("input")[2].value=e.lastInput),e.ahref&&(props[t].getElementsByTagName("input")[3].value=e.ahref),e.aalt&&(props[t].getElementsByTagName("input")[4].value=e.aalt),e.atarget&&(props[t].getElementsByTagName("select")[1].value=e.atarget))}function gui_htmlBlur(){var e=document.getElementById("html_container");e.getAttribute("oldvalue")!=e.value&&"imagemap"==document.getElementById("dd_output").value&&myimgmap.setMapHTML(e.value)}function gui_htmlFocus(){var e=document.getElementById("html_container");e.setAttribute("oldvalue",e.value),e.select()}function gui_htmlShow(){toggleFieldset(document.getElementById("fieldset_html"),1),document.getElementById("html_container").focus()}function changelabeling(e){myimgmap.config.label=e.value,myimgmap._repaintAll()}function toggleBoundingBox(e){e.checked=!e.checked,e.innerHTML="&nbsp; bounding box",e.checked&&(e.innerHTML="&raquo; bounding box"),myimgmap.config.bounding_box=e.checked,myimgmap.relaxAllAreas(),gui_toggleMore()}function toggleFieldset(e,t){e&&("fieldset_off"==e.className||1==t?e.className="":e.className="fieldset_off")}function gui_selectArea(e){gui_row_select(e.aid,!0,!1)}function gui_zoom(){var e=document.getElementById("dd_zoom").value,t=document.getElementById("pic_container").getElementsByTagName("img")[0];if(void 0===t)return!1;void 0!==t.oldwidth&&t.oldwidth||(t.oldwidth=t.width),void 0!==t.oldheight&&t.oldheight||(t.oldheight=t.height),t.width=t.oldwidth*e,t.height=t.oldheight*e,myimgmap.scaleAllAreas(e)}function print_hero_picture_info(e,t,a){(xmldata=new AJAX_Handler(!0)).src=urlencode(e),xmldata.mode=urlencode(t),xmldata.folder=urlencode(a),xmldata.id=urlencode(fetch_js_object("source_url3_id").value),xmldata.onreadystatechange(function(){if(4==xmldata.handler.readyState&&200==xmldata.handler.status){if(""!=xmldata.handler.responseText){var e;e=xmldata.handler.responseText.split("|"),"load"==xmldata.mode?(myimgmap.loadImage(iL.IMGUPLOADSCDN+xmldata.folder+"/"+xmldata.src,e[4],e[5]),fetch_js_object("pic_displayorder").innerHTML='<input type="text" name="sort" id="sort" value="'+e[0]+'" class="draw-input" /><input type="hidden" name="img_width" id="img_width" value="'+e[4]+'"><input type="hidden" name="img_height" id="img_height" value="'+e[5]+'">',fetch_js_object("html_container").value=e[1],fetch_js_object("pic_categoryid").innerHTML=e[3],fetch_js_object("pic_styleid").innerHTML=e[6],e[4]>=1200?document.getElementById("dd_zoom").value="0.75":document.getElementById("dd_zoom").value="1",""!=e[1]&&gui_htmlBlur(),gui_zoom()):"insert"==xmldata.mode&&(myimgmap.loadImage(iL.IMGUPLOADSCDN+xmldata.folder+"/"+xmldata.src,e[4],e[5]),fetch_js_object("pic_displayorder").innerHTML='<input type="text" name="sort" id="sort" value="'+(parseInt(e[0])+parseInt(10))+'" class="draw-input" /><input type="hidden" name="img_width" id="img_width" value="'+e[4]+'"><input type="hidden" name="img_height" id="img_height" value="'+e[5]+'">',fetch_js_object("html_container").value="",fetch_js_object("pic_categoryid").innerHTML=e[3],fetch_js_object("pic_styleid").innerHTML=e[6],e[4]>=1200?document.getElementById("dd_zoom").value="0.75":document.getElementById("dd_zoom").value="1",gui_zoom())}xmldata.handler.abort()}}),xmldata.send(iL.AJAXURL,"do=heropicture&id="+xmldata.id+"&cid="+xmldata.cid+"&filename="+xmldata.src+"&mode="+xmldata.mode+"&folder="+xmldata.folder+"&token="+iL.TOKEN)}function gui_loadImage(e,t,a){var i=document.getElementById("pic_container").getElementsByTagName("img")[0];void 0!==i&&(i.parentNode.removeChild(i),delete myimgmap.pic),"load"==t?(toggle_show("savebutton"),toggle_hide("insertbutton")):"insert"==t&&(toggle_show("insertbutton"),toggle_hide("savebutton")),print_hero_picture_info(e,t,a)}function gui_outputChanged(){var e,t=window.clipboardData||"object"==typeof air,a=document.getElementById("dd_output").value;return e="This is the generated image map HTML code. ",e+="Click into the textarea below and press Ctrl+C to copy the code to your clipboard. ",t&&(e+="Alternatively you can use the clipboard icon on the right. ",e+='<img src="example1_files/clipboard.gif" onclick="gui_toClipBoard()" style="float: right; margin: 4px; cursor: pointer;"/>'),e+="Please note, that you have to attach this code to your image, via the usemap property ",e+='(<a href="http://www.htmlhelp.com/reference/html40/special/map.html">read more</a>). ',myimgmap.setMapHTML(myimgmap.getMapHTML()),outputmode=a,!0}function gui_toClipBoard(e){void 0===e&&(e=document.getElementById("html_container").value);try{window.clipboardData?window.clipboardData.setData("Text",e):"object"==typeof air&&(air.Clipboard.generalClipboard.clear(),air.Clipboard.generalClipboard.setData("air:text",e,!1))}catch(t){myimgmap.log("Unable to set clipboard data",1)}}myimgmap=new imgmap({mode:"editor",custom_callbacks:{onStatusMessage:function(e){gui_statusMessage(e)},onHtmlChanged:function(e){gui_htmlChanged(e)},onModeChanged:function(e){gui_modeChanged(e)},onAddArea:function(e){gui_addArea(e)},onRemoveArea:function(e){gui_removeArea(e)},onAreaChanged:function(e){gui_areaChanged(e)},onSelectArea:function(e){gui_selectArea(e)}},pic_container:document.getElementById("pic_container"),bounding_box:!1}),props=[],imgroot=iL.IMGUPLOADS+"vendor/imap/",outputmode="imgmap",gui_outputChanged(),myimgmap.addEvent(document.getElementById("html_container"),"blur",gui_htmlBlur),myimgmap.addEvent(document.getElementById("html_container"),"focus",gui_htmlFocus);