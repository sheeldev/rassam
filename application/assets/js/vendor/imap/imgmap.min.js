function imgmap(a){this.version="2.2";this.buildDate="2009/07/26 16:29";this.buildNumber="108";this.config={};this.is_drawing=0;this.strings=[];this.memory=[];this.areas=[];this.logStore=[];this.eventHandlers={};this.currentid=0;this.draggedId=null;this.selectedId=null;this.nextShape="rect";this.viewmode=0;this.loadedScripts=[];this.isLoaded=false;this.cntReloads=0;this.mapname="";this.mapid="";this.globalscale=1;this.DM_RECTANGLE_DRAW=1;this.DM_RECTANGLE_MOVE=11;this.DM_RECTANGLE_RESIZE_TOP=12;this.DM_RECTANGLE_RESIZE_RIGHT=13;this.DM_RECTANGLE_RESIZE_BOTTOM=14;this.DM_RECTANGLE_RESIZE_LEFT=15;this.DM_SQUARE_DRAW=2;this.DM_SQUARE_MOVE=21;this.DM_SQUARE_RESIZE_TOP=22;this.DM_SQUARE_RESIZE_RIGHT=23;this.DM_SQUARE_RESIZE_BOTTOM=24;this.DM_SQUARE_RESIZE_LEFT=25;this.DM_POLYGON_DRAW=3;this.DM_POLYGON_LASTDRAW=30;this.DM_POLYGON_MOVE=31;this.DM_BEZIER_DRAW=4;this.DM_BEZIER_LASTDRAW=40;this.DM_BEZIER_MOVE=41;this.config.mode="editor";this.config.baseroot="/application/assets/javascript/vendor/imap/";this.config.lang="";this.config.defaultLang="en";this.config.loglevel=0;this.config.custom_callbacks={};this.event_types=["onModeChanged","onHtmlChanged","onAddArea","onRemoveArea","onDrawArea","onResizeArea","onRelaxArea","onFocusArea","onBlurArea","onMoveArea","onSelectRow","onLoadImage","onSetMap","onGetMap","onSelectArea","onDblClickArea","onStatusMessage","onAreaChanged"];this.config.CL_DRAW_BOX="#E32636";this.config.CL_DRAW_SHAPE="#d00";this.config.CL_DRAW_BG="#fff";this.config.CL_NORM_BOX="#E32636";this.config.CL_NORM_SHAPE="#d00";this.config.CL_NORM_BG="#fff";this.config.CL_HIGHLIGHT_BOX="#E32636";this.config.CL_HIGHLIGHT_SHAPE="#d00";this.config.CL_HIGHLIGHT_BG="#fff";this.config.CL_KNOB="#555";this.config.bounding_box=true;this.config.label="";this.config.label_class="imgmap_label";this.config.label_style="font: bold 10px Arial";this.config.hint="#%n %h";this.config.draw_opacity="35";this.config.norm_opacity="50";this.config.highlight_opacity="70";this.config.cursor_default="crosshair";var b=navigator.userAgent;this.isMSIE=(navigator.appName=="Microsoft Internet Explorer");this.isMSIE5=this.isMSIE&&(b.indexOf("MSIE 5")!=-1);this.isMSIE5_0=this.isMSIE&&(b.indexOf("MSIE 5.0")!=-1);this.isMSIE7=this.isMSIE&&(b.indexOf("MSIE 7")!=-1);this.isGecko=b.indexOf("Gecko")!=-1;this.isSafari=b.indexOf("Safari")!=-1;this.isOpera=(typeof window.opera!="undefined");this.setup(a)}imgmap.prototype.assignOID=function(b){try{if(typeof b=="undefined"){this.log("Undefined object passed to assignOID.");return null}else{if(typeof b=="object"){return b}else{if(typeof b=="string"){return document.getElementById(b)}}}}catch(a){this.log("Error in assignOID",1)}return null};imgmap.prototype.setup=function(e){for(var h in e){if(e.hasOwnProperty(h)){this.config[h]=e[h]}}this.addEvent(document,"keydown",this.eventHandlers.doc_keydown=this.doc_keydown.bind(this));this.addEvent(document,"keyup",this.eventHandlers.doc_keyup=this.doc_keyup.bind(this));this.addEvent(document,"mousedown",this.eventHandlers.doc_mousedown=this.doc_mousedown.bind(this));if(e&&e.pic_container){this.pic_container=this.assignOID(e.pic_container);this.disableSelection(this.pic_container)}if(!this.config.baseroot){var c=document.getElementsByTagName("base");var d="";for(h=0;h<c.length;h++){if(c[h].href){d=c[h].href;if(d.charAt(d.length-1)!="/"){d+="/"}break}}var f=document.getElementsByTagName("script");for(h=0;h<f.length;h++){if(f[h].src&&f[h].src.match(/imgmap\w*\.js(\?.*?)?$/)){var b=f[h].src;b=b.substring(0,b.lastIndexOf("/")+1);if(d&&b.indexOf("://")==-1){this.config.baseroot=d+b}else{this.config.baseroot=b}break}}}if(this.isMSIE&&typeof window.CanvasRenderingContext2D=="undefined"&&typeof G_vmlCanvasManager=="undefined"){this.loadScript(this.config.baseroot+"excanvas"+((iL.MINIFY=="1")?".min.js":".js"))}if(!this.config.lang){this.config.lang=this.detectLanguage()}if(typeof imgmapStrings=="undefined"){this.loadScript(this.config.baseroot+"lang_"+this.config.lang+((iL.MINIFY=="1")?".min.js":".js"))}var k,g,a;for(h in this.config.custom_callbacks){if(this.config.custom_callbacks.hasOwnProperty(h)){k=false;for(g=0,a=this.event_types.length;g<a;g++){if(h==this.event_types[g]){k=true;break}}if(!k){this.log("Unknown custom callback: "+h,1)}}}this.addEvent(window,"load",this.onLoad.bind(this));return true};imgmap.prototype.retryDelayed=function(b,a,c){if(typeof b.tries=="undefined"){b.tries=0}if(b.tries++<c){window.setTimeout(function(){b.apply(this)},a)}};imgmap.prototype.onLoad=function(b){if(this.isLoaded){return true}var c=this;if(typeof imgmapStrings=="undefined"){if(this.cntReloads++<5){window.setTimeout(function(){c.onLoad(b)},1200);this.log("Delaying onload (language "+this.config.lang+" not loaded, try: "+this.cntReloads+")");return false}else{if(this.config.lang!=this.config.defaultLang&&this.config.defaultLang!="en"){this.log("Falling back to default language: "+this.config.defaultLang);this.cntReloads=0;this.config.lang=this.config.defaultLang;this.loadScript(this.config.baseroot+"lang_"+this.config.lang+((iL.MINIFY=="1")?".min.js":".js"));window.setTimeout(function(){c.onLoad(b)},1200);return false}else{if(this.config.lang!="en"){this.log("Falling back to english language");this.cntReloads=0;this.config.lang="en";this.loadScript(this.config.baseroot+"lang_"+this.config.lang+((iL.MINIFY=="1")?".min.js":".js"));window.setTimeout(function(){c.onLoad(b)},1200);return false}}}}try{this.loadStrings(imgmapStrings)}catch(a){this.log("Unable to load language strings",1)}if(this.isMSIE){if(typeof window.CanvasRenderingContext2D=="undefined"&&typeof G_vmlCanvasManager=="undefined"){this.log(this.strings.ERR_EXCANVAS_LOAD,2)}}if(this.config.mode=="highlighter"){imgmap_spawnObjects(this.config)}this.isLoaded=true;return true};imgmap.prototype.addEvent=function(b,a,c){if(b.attachEvent){return b.attachEvent("on"+a,c)}else{if(b.addEventListener){b.addEventListener(a,c,false);return true}else{b["on"+a]=c}}};imgmap.prototype.removeEvent=function(b,a,c){if(b.detachEvent){return b.detachEvent("on"+a,c)}else{if(b.removeEventListener){b.removeEventListener(a,c,false);return true}else{b["on"+a]=null}}};imgmap.prototype.addLoadEvent=function(a,b){if(a.attachEvent){return a.attachEvent("onreadystatechange",b)}else{if(a.addEventListener){a.addEventListener("load",b,false);return true}else{a.onload=b}}};imgmap.prototype.loadScript=function(b){if(b===""){return false}if(this.loadedScripts[b]==1){return true}try{var c=document.getElementsByTagName("head")[0];var a=document.createElement("SCRIPT");a.setAttribute("language","javascript");a.setAttribute("type","text/javascript");a.setAttribute("src",b);c.appendChild(a);this.addLoadEvent(a,this.script_load.bind(this))}catch(d){this.log("Error loading script: "+b)}return true};imgmap.prototype.script_load=function(d){var c=(this.isMSIE)?window.event.srcElement:d.currentTarget;var b=c.src;var a=false;if(typeof c.readyState!="undefined"){if(c.readyState=="complete"){a=true}}else{a=true}if(a){this.loadedScripts[b]=1;this.log("Loaded script: "+b);return true}};imgmap.prototype.loadStrings=function(b){for(var a in b){if(b.hasOwnProperty(a)){this.strings[a]=b[a]}}};imgmap.prototype.loadImage=function(a,b,e){if(typeof this.pic_container=="undefined"){this.log("You must have pic_container defined to use loadImage!",2);return false}this.removeAllAreas();this.globalscale=1;this.fireEvent("onHtmlChanged","");if(!this._getLastArea()){if(this.config.mode!="editor2"){this.addNewArea()}}if(typeof a=="string"){if(typeof this.pic=="undefined"){this.pic=document.createElement("IMG");this.pic_container.appendChild(this.pic);this.addEvent(this.pic,"mousedown",this.eventHandlers.img_mousedown=this.img_mousedown.bind(this));this.addEvent(this.pic,"mouseup",this.eventHandlers.img_mouseup=this.img_mouseup.bind(this));this.addEvent(this.pic,"mousemove",this.eventHandlers.img_mousemove=this.img_mousemove.bind(this));this.pic.style.cursor=this.config.cursor_default}this.log("Loading image: "+a,0);var c="?";if(a.indexOf("?")>-1){c="&"}this.pic.src=a+c+(new Date().getTime());if(b&&b>0){this.pic.setAttribute("width",b)}if(e&&e>0){this.pic.setAttribute("height",e)}this.fireEvent("onLoadImage",this.pic);return true}else{if(typeof a=="object"){var d=a.src;if(d===""&&a.getAttribute("mce_src")!==""){d=a.getAttribute("mce_src")}else{if(d===""&&a.getAttribute("_fcksavedurl")!==""){d=a.getAttribute("_fcksavedurl")}}if(!b){b=a.clientWidth}if(!e){e=a.clientHeight}return this.loadImage(d,b,e)}}};imgmap.prototype.useImage=function(a){this.removeAllAreas();if(!this._getLastArea()){if(this.config.mode!="editor2"){this.addNewArea()}}a=this.assignOID(a);if(typeof a=="object"){if(typeof this.pic!="undefined"){this.removeEvent(this.pic,"mousedown",this.eventHandlers.img_mousedown);this.removeEvent(this.pic,"mouseup",this.eventHandlers.img_mouseup);this.removeEvent(this.pic,"mousemove",this.eventHandlers.img_mousemove);this.pic.style.cursor=""}this.pic=a;this.addEvent(this.pic,"mousedown",this.eventHandlers.img_mousedown=this.img_mousedown.bind(this));this.addEvent(this.pic,"mouseup",this.eventHandlers.img_mouseup=this.img_mouseup.bind(this));this.addEvent(this.pic,"mousemove",this.eventHandlers.img_mousemove=this.img_mousemove.bind(this));this.pic.style.cursor=this.config.cursor_default;if(this.pic.parentNode.className=="pic_container"){this.pic_container=this.pic.parentNode}else{this.pic_container=document.createElement("div");this.pic_container.className="pic_container";this.pic.parentNode.insertBefore(this.pic_container,this.pic);this.pic_container.appendChild(this.pic)}this.fireEvent("onLoadImage",this.pic);return true}};imgmap.prototype.statusMessage=function(a){this.fireEvent("onStatusMessage",a)};imgmap.prototype.log=function(c,e){if(e===""||typeof e=="undefined"){e=0}if(this.config.loglevel!=-1&&e>=this.config.loglevel){this.logStore.push({level:e,obj:c})}if(typeof console=="object"){console.log(c)}else{if(this.isOpera){opera.postError(e+": "+c)}else{if(typeof air=="object"){if(typeof air.Introspector=="object"){air.Introspector.Console.log(c)}else{air.trace(c)}}else{if(e>1){var d="";for(var b=0,a=this.logStore.length;b<a;b++){d+=this.logStore[b].level+": "+this.logStore[b].obj+"\n"}alert(d)}else{window.defaultStatus=(e+": "+c)}}}}};imgmap.prototype.getMapHTML=function(a){var b='<map id="hero_{id}" name="hero_{id}">'+this.getMapInnerHTML(a)+"</map>";this.fireEvent("onGetMap",b);return b};imgmap.prototype.getMapInnerHTML=function(a){var e,h;e="";for(var d=0,c=this.areas.length;d<c;d++){if(this.areas[d]){if(this.areas[d].shape&&this.areas[d].shape!="undefined"){h=this.areas[d].lastInput;if(a&&a.match(/noscale/)){var g=h.split(",");for(var b=0,f=g.length;b<f;b++){g[b]=Math.round(g[b]*this.globalscale)}h=g.join(",")}e+='<area shape="'+this.areas[d].shape+'" alt="'+this.areas[d].aalt+'" title="'+this.areas[d].atitle+'" coords="'+h+'" href="'+this.areas[d].ahref+'" target="'+this.areas[d].atarget+'" />'}}}return e};imgmap.prototype.getMapName=function(){if(this.mapname===""){if(this.mapid!==""){return this.mapid}var a=new Date();this.mapname="imgmap"+a.getFullYear()+(a.getMonth()+1)+a.getDate()+a.getHours()+a.getMinutes()+a.getSeconds()}return this.mapname};imgmap.prototype.getMapId=function(){if(this.mapid===""){this.mapid=this.getMapName()}return this.mapid};imgmap.prototype._normShape=function(a){if(!a){return"rect"}a=this.trim(a).toLowerCase();if(a.substring(0,4)=="rect"){return"rect"}if(a.substring(0,4)=="circ"){return"circle"}if(a.substring(0,4)=="poly"){return"poly"}return"rect"};imgmap.prototype._normCoords=function(s,a,t){var u;var m;var k;var h;var g;var x,n;s=this.trim(s);if(s===""){return""}var o=s;s=s.replace(/(\d)(\D)+(\d)/g,"$1,$3");s=s.replace(/,\D+(\d)/g,",$1");s=s.replace(/,0+(\d)/g,",$1");s=s.replace(/(\d)(\D)+,/g,"$1,");s=s.replace(/^\D+(\d)/g,"$1");s=s.replace(/^0+(\d)/g,"$1");s=s.replace(/(\d)(\D)+$/g,"$1");var p=s.split(",");if(a=="rect"){if(t=="fromcircle"){var l=p[2];p[0]=p[0]-l;p[1]=p[1]-l;p[2]=parseInt(p[0],10)+2*l;p[3]=parseInt(p[1],10)+2*l}else{if(t=="frompoly"){m=parseInt(p[0],10);h=parseInt(p[0],10);k=parseInt(p[1],10);g=parseInt(p[1],10);for(u=0,n=p.length;u<n;u++){if(u%2===0&&parseInt(p[u],10)<m){m=parseInt(p[u],10)}if(u%2===1&&parseInt(p[u],10)<k){k=parseInt(p[u],10)}if(u%2===0&&parseInt(p[u],10)>h){h=parseInt(p[u],10)}if(u%2===1&&parseInt(p[u],10)>g){g=parseInt(p[u],10)}}p[0]=m;p[1]=k;p[2]=h;p[3]=g}}if(!(parseInt(p[1],10)>=0)){p[1]=p[0]}if(!(parseInt(p[2],10)>=0)){p[2]=parseInt(p[0],10)+10}if(!(parseInt(p[3],10)>=0)){p[3]=parseInt(p[1],10)+10}if(parseInt(p[0],10)>parseInt(p[2],10)){x=p[0];p[0]=p[2];p[2]=x}if(parseInt(p[1],10)>parseInt(p[3],10)){x=p[1];p[1]=p[3];p[3]=x}s=p[0]+","+p[1]+","+p[2]+","+p[3]}else{if(a=="circle"){if(t=="fromrect"){m=parseInt(p[0],10);h=parseInt(p[2],10);k=parseInt(p[1],10);g=parseInt(p[3],10);p[2]=(h-m<g-k)?h-m:g-k;p[2]=Math.floor(p[2]/2);p[0]=m+p[2];p[1]=k+p[2]}else{if(t=="frompoly"){m=parseInt(p[0],10);h=parseInt(p[0],10);k=parseInt(p[1],10);g=parseInt(p[1],10);for(u=0,n=p.length;u<n;u++){if(u%2===0&&parseInt(p[u],10)<m){m=parseInt(p[u],10)}if(u%2===1&&parseInt(p[u],10)<k){k=parseInt(p[u],10)}if(u%2===0&&parseInt(p[u],10)>h){h=parseInt(p[u],10)}if(u%2===1&&parseInt(p[u],10)>g){g=parseInt(p[u],10)}}p[2]=(h-m<g-k)?h-m:g-k;p[2]=Math.floor(p[2]/2);p[0]=m+p[2];p[1]=k+p[2]}}if(!(parseInt(p[1],10)>0)){p[1]=p[0]}if(!(parseInt(p[2],10)>0)){p[2]=10}s=p[0]+","+p[1]+","+p[2]}else{if(a=="poly"){if(t=="fromrect"){p[4]=p[2];p[5]=p[3];p[2]=p[0];p[6]=p[4];p[7]=p[1]}else{if(t=="fromcircle"){var f=parseInt(p[0],10);var e=parseInt(p[1],10);var b=parseInt(p[2],10);var q=0;p[q++]=f+b;p[q++]=e;var w=60;for(u=0;u<=w;u++){var y=u/w;var v=Math.cos(y*2*Math.PI);var z=Math.sin(y*2*Math.PI);var d=f+v*b;var c=e+z*b;p[q++]=Math.round(d);p[q++]=Math.round(c)}}}s=p.join(",")}else{if(a=="bezier1"){s=p.join(",")}}}}if(t=="preserve"&&o!=s){return o}return s};imgmap.prototype.setMapHTML=function(b){if(this.viewmode===1){return}this.fireEvent("onSetMap",b);this.removeAllAreas();var e;if(typeof b=="string"){var o=document.createElement("DIV");o.innerHTML=b;e=o.firstChild}else{if(typeof b=="object"){e=b}}if(!e||e.nodeName.toLowerCase()!=="map"){return false}this.mapname=e.name;this.mapid=e.id;var h=e.getElementsByTagName("area");var k,m,c,g,l,j,d;for(var f=0,a=h.length;f<a;f++){k=m=c=g=l=j="";d=this.addNewArea();k=this._normShape(h[f].getAttribute("shape",2));this.initArea(d,k);if(h[f].getAttribute("coords",2)){m=this._normCoords(h[f].getAttribute("coords",2),k);this.areas[d].lastInput=m}c=h[f].getAttribute("href",2);var n=h[f].getAttribute("_fcksavedurl");if(n){c=n}if(c){this.areas[d].ahref=c}g=h[f].getAttribute("alt");if(g){this.areas[d].aalt=g}l=h[f].getAttribute("title");if(!l){l=g}if(l){this.areas[d].atitle=l}j=h[f].getAttribute("target");if(j){j=j.toLowerCase()}this.areas[d].atarget=j;this._recalculate(d,m);this.relaxArea(d);this.fireEvent("onAreaChanged",this.areas[d])}this.fireEvent("onHtmlChanged",this.getMapHTML());return true};imgmap.prototype.togglePreview=function(){var b,a;if(!this.pic){return false}if(!this.preview){this.preview=document.createElement("DIV");this.preview.style.display="none";this.pic_container.appendChild(this.preview)}if(this.viewmode===0){for(b=0,a=this.areas.length;b<a;b++){if(this.areas[b]){this.areas[b].style.display="none";if(this.areas[b].label){this.areas[b].label.style.display="none"}}}this.preview.innerHTML=this.getMapHTML("noscale");this.pic.setAttribute("border","0",0);this.pic.setAttribute("usemap","#"+this.mapname,0);this.pic.style.cursor="auto";this.viewmode=1;this.statusMessage(this.strings.PREVIEW_MODE)}else{for(b=0,a=this.areas.length;b<a;b++){if(this.areas[b]){this.areas[b].style.display="";if(this.areas[b].label&&this.config.label){this.areas[b].label.style.display=""}}}this.preview.innerHTML="";this.pic.style.cursor=this.config.cursor_default;this.pic.removeAttribute("usemap",0);this.viewmode=0;this.statusMessage(this.strings.DESIGN_MODE);this.is_drawing=0}this.fireEvent("onModeChanged",this.viewmode);return this.viewmode};imgmap.prototype.addNewArea=function(){if(this.viewmode===1){return}var a=this._getLastArea();var b=(a)?a.aid+1:0;this.areas[b]=document.createElement("DIV");this.areas[b].id=this.mapname+"area"+b;this.areas[b].aid=b;this.areas[b].shape="undefined";this.currentid=b;this.fireEvent("onAddArea",b);return b};imgmap.prototype.initArea=function(b,a){if(!this.areas[b]){return false}if(this.areas[b].parentNode){this.areas[b].parentNode.removeChild(this.areas[b])}if(this.areas[b].label){this.areas[b].label.parentNode.removeChild(this.areas[b].label)}this.areas[b]=null;this.areas[b]=document.createElement("CANVAS");this.pic_container.appendChild(this.areas[b]);this.pic_container.style.position="relative";if(typeof G_vmlCanvasManager!="undefined"){this.areas[b]=G_vmlCanvasManager.initElement(this.areas[b])}this.areas[b].id=this.mapname+"area"+b;this.areas[b].aid=b;this.areas[b].shape=a;this.areas[b].ahref="";this.areas[b].atitle="";this.areas[b].aalt="";this.areas[b].atarget="";this.areas[b].style.position="absolute";this.areas[b].style.top=this.pic.offsetTop+"px";this.areas[b].style.left=this.pic.offsetLeft+"px";this._setopacity(this.areas[b],this.config.CL_DRAW_BG,this.config.draw_opacity);this.areas[b].ondblclick=this.area_dblclick.bind(this);this.areas[b].onmousedown=this.area_mousedown.bind(this);this.areas[b].onmouseup=this.area_mouseup.bind(this);this.areas[b].onmousemove=this.area_mousemove.bind(this);this.areas[b].onmouseover=this.area_mouseover.bind(this);this.areas[b].onmouseout=this.area_mouseout.bind(this);this.memory[b]={};this.memory[b].downx=0;this.memory[b].downy=0;this.memory[b].left=0;this.memory[b].top=0;this.memory[b].width=0;this.memory[b].height=0;this.memory[b].xpoints=[];this.memory[b].ypoints=[];this.areas[b].label=document.createElement("DIV");this.pic_container.appendChild(this.areas[b].label);this.areas[b].label.className=this.config.label_class;this.assignCSS(this.areas[b].label,this.config.label_style);this.areas[b].label.style.position="absolute"};imgmap.prototype.relaxArea=function(a){if(!this.areas[a]){return}this.fireEvent("onRelaxArea",a);this._setBorder(a,"NORM");this._setopacity(this.areas[a],this.config.CL_NORM_BG,this.config.norm_opacity)};imgmap.prototype.relaxAllAreas=function(){for(var b=0,a=this.areas.length;b<a;b++){if(this.areas[b]){this.relaxArea(b)}}};imgmap.prototype._setBorder=function(b,a){if(this.areas[b].shape=="rect"||this.config.bounding_box){this.areas[b].style.borderWidth="1px";this.areas[b].style.borderStyle=(a=="DRAW"?"dotted":"solid");this.areas[b].style.borderColor=this.config["CL_"+a+"_"+(this.areas[b].shape=="rect"?"SHAPE":"BOX")]}else{this.areas[b].style.border=""}};imgmap.prototype._setopacity=function(b,a,c){if(a){b.style.backgroundColor=a}if(c&&typeof c=="string"&&c.match(/^\d*\-\d+$/)){var f=c.split("-");if(typeof f[0]!="undefined"){f[0]=parseInt(f[0],10);this._setopacity(b,a,f[0])}if(typeof f[1]!="undefined"){f[1]=parseInt(f[1],10);var e=this._getopacity(b);var g=this;var d=Math.round(f[1]-e);if(d>5){window.setTimeout(function(){g._setopacity(b,null,"-"+f[1])},20);c=1*e+5}else{if(d<-3){window.setTimeout(function(){g._setopacity(b,null,"-"+f[1])},20);c=1*e-3}else{c=f[1]}}}}if(!isNaN(c)){c=Math.round(parseInt(c,10));b.style.opacity=c/100;b.style.filter="alpha(opacity="+c+")"}};imgmap.prototype._getopacity=function(a){if(a.style.opacity<=1){return a.style.opacity*100}if(a.style.filter){return parseInt(a.style.filter.replace(/alpha\(opacity\=([^\)]*)\)/ig,"$1"),10)}return 100};imgmap.prototype.removeArea=function(c,a){if(this.viewmode===1){return}if(c===null||typeof c=="undefined"){return}try{this.areas[c].label.parentNode.removeChild(this.areas[c].label);this.areas[c].parentNode.removeChild(this.areas[c]);this.areas[c].label.className=null;this.areas[c].label=null;this.areas[c].onmouseover=null;this.areas[c].onmouseout=null;this.areas[c].onmouseup=null;this.areas[c].onmousedown=null;this.areas[c].onmousemove=null}catch(b){}this.areas[c]=null;this.fireEvent("onRemoveArea",c);if(!a){this.fireEvent("onHtmlChanged",this.getMapHTML())}};imgmap.prototype.removeAllAreas=function(){for(var b=0,a=this.areas.length;b<a;b++){if(this.areas[b]){this.removeArea(b,true)}}this.fireEvent("onHtmlChanged",this.getMapHTML())};imgmap.prototype.scaleAllAreas=function(e){var d=1;try{d=e/this.globalscale}catch(c){this.log("Invalid (global)scale",1)}this.globalscale=e;for(var b=0,a=this.areas.length;b<a;b++){if(this.areas[b]&&this.areas[b].shape!="undefined"){this.scaleArea(b,d)}}};imgmap.prototype.scaleArea=function(d,c){this.areas[d].style.top=parseInt(this.areas[d].style.top,10)*c+"px";this.areas[d].style.left=parseInt(this.areas[d].style.left,10)*c+"px";this.setAreaSize(d,this.areas[d].width*c,this.areas[d].height*c);if(this.areas[d].shape=="poly"||this.areas[d].shape=="bezier1"){for(var b=0,a=this.areas[d].xpoints.length;b<a;b++){this.areas[d].xpoints[b]*=c;this.areas[d].ypoints[b]*=c}}this._repaint(this.areas[d],this.config.CL_NORM_SHAPE);this._updatecoords(d)};imgmap.prototype._putlabel=function(c){if(this.viewmode===1){return}if(!this.areas[c].label){return}try{if(!this.config.label){this.areas[c].label.innerHTML="";this.areas[c].label.style.display="none"}else{this.areas[c].label.style.display="";var a=this.config.label;a=a.replace(/%n/g,String(c));a=a.replace(/%c/g,String(this.areas[c].lastInput));a=a.replace(/%h/g,String(this.areas[c].ahref));a=a.replace(/%a/g,String(this.areas[c].aalt));a=a.replace(/%t/g,String(this.areas[c].atitle));this.areas[c].label.innerHTML=a}this.areas[c].label.style.top=this.areas[c].style.top;this.areas[c].label.style.left=this.areas[c].style.left}catch(b){this.log("Error putting label",1)}};imgmap.prototype._puthint=function(c){try{if(!this.config.hint){this.areas[c].title="";this.areas[c].alt=""}else{var b=this.config.hint;b=b.replace(/%n/g,String(c));b=b.replace(/%c/g,String(this.areas[c].lastInput));b=b.replace(/%h/g,String(this.areas[c].ahref));b=b.replace(/%a/g,String(this.areas[c].aalt));b=b.replace(/%t/g,String(this.areas[c].atitle));this.areas[c].title=b;this.areas[c].alt=b}}catch(a){this.log("Error putting hint",1)}};imgmap.prototype._repaintAll=function(){for(var b=0,a=this.areas.length;b<a;b++){if(this.areas[b]){this._repaint(this.areas[b],this.config.CL_NORM_SHAPE)}}};imgmap.prototype._repaint=function(b,e,k,j){var m;var c,l,d,h;var f,a;if(b.shape=="circle"){c=parseInt(b.style.width,10);var g=Math.floor(c/2)-1;m=b.getContext("2d");m.clearRect(0,0,c,c);m.beginPath();m.strokeStyle=e;m.arc(g,g,g,0,Math.PI*2,0);m.stroke();m.closePath();m.strokeStyle=this.config.CL_KNOB;m.strokeRect(g,g,1,1);this._putlabel(b.aid);this._puthint(b.aid)}else{if(b.shape=="rect"){this._putlabel(b.aid);this._puthint(b.aid)}else{if(b.shape=="poly"){c=parseInt(b.style.width,10);l=parseInt(b.style.height,10);d=parseInt(b.style.left,10);h=parseInt(b.style.top,10);if(b.xpoints){m=b.getContext("2d");m.clearRect(0,0,c,l);m.beginPath();m.strokeStyle=e;m.moveTo(b.xpoints[0]-d,b.ypoints[0]-h);for(f=1,a=b.xpoints.length;f<a;f++){m.lineTo(b.xpoints[f]-d,b.ypoints[f]-h)}if(this.is_drawing==this.DM_POLYGON_DRAW||this.is_drawing==this.DM_POLYGON_LASTDRAW){m.lineTo(k-d-5,j-h-5)}m.lineTo(b.xpoints[0]-d,b.ypoints[0]-h);m.stroke();m.closePath()}this._putlabel(b.aid);this._puthint(b.aid)}else{if(b.shape=="bezier1"){c=parseInt(b.style.width,10);l=parseInt(b.style.height,10);d=parseInt(b.style.left,10);h=parseInt(b.style.top,10);if(b.xpoints){m=b.getContext("2d");m.clearRect(0,0,c,l);m.beginPath();m.strokeStyle=e;m.moveTo(b.xpoints[0]-d,b.ypoints[0]-h);for(f=2,a=b.xpoints.length;f<a;f+=2){m.quadraticCurveTo(b.xpoints[f-1]-d,b.ypoints[f-1]-h,b.xpoints[f]-d,b.ypoints[f]-h)}if(this.is_drawing==this.DM_BEZIER_DRAW||this.is_drawing==this.DM_BEZIER_LASTDRAW){if(b.xpoints.length%2===0&&b.xpoints.length>1){m.quadraticCurveTo(b.xpoints[b.xpoints.length-1]-d-5,b.ypoints[b.ypoints.length-1]-h-5,k-d-5,j-h-5)}else{m.lineTo(k-d-5,j-h-5)}}m.lineTo(b.xpoints[0]-d,b.ypoints[0]-h);m.stroke();m.closePath()}this._putlabel(b.aid);this._puthint(b.aid)}}}}};imgmap.prototype._updatecoords=function(b){var d=Math.round(parseInt(this.areas[b].style.left,10)/this.globalscale);var g=Math.round(parseInt(this.areas[b].style.top,10)/this.globalscale);var j=Math.round(parseInt(this.areas[b].style.height,10)/this.globalscale);var c=Math.round(parseInt(this.areas[b].style.width,10)/this.globalscale);var h="";if(this.areas[b].shape=="rect"){h=d+","+g+","+(d+c)+","+(g+j);this.areas[b].lastInput=h}else{if(this.areas[b].shape=="circle"){var f=Math.floor(c/2)-1;h=(d+f)+","+(g+f)+","+f;this.areas[b].lastInput=h}else{if(this.areas[b].shape=="poly"||this.areas[b].shape=="bezier1"){if(this.areas[b].xpoints){for(var e=0,a=this.areas[b].xpoints.length;e<a;e++){h+=Math.round(this.areas[b].xpoints[e]/this.globalscale)+","+Math.round(this.areas[b].ypoints[e]/this.globalscale)+","}h=h.substring(0,h.length-1)}this.areas[b].lastInput=h}}}this.fireEvent("onAreaChanged",this.areas[b]);this.fireEvent("onHtmlChanged",this.getMapHTML())};imgmap.prototype._recalculate=function(h,e){try{if(e){e=this._normCoords(e,this.areas[h].shape,"preserve")}else{e=this.areas[h].lastInput||""}var f=e.split(",");if(this.areas[h].shape=="rect"){if(f.length!=4||parseInt(f[0],10)>parseInt(f[2],10)||parseInt(f[1],10)>parseInt(f[3],10)){throw"invalid coords"}this.areas[h].style.left=this.globalscale*(this.pic.offsetLeft+parseInt(f[0],10))+"px";this.areas[h].style.top=this.globalscale*(this.pic.offsetTop+parseInt(f[1],10))+"px";this.setAreaSize(h,this.globalscale*(f[2]-f[0]),this.globalscale*(f[3]-f[1]));this._repaint(this.areas[h],this.config.CL_NORM_SHAPE)}else{if(this.areas[h].shape=="circle"){if(f.length!=3||parseInt(f[2],10)<0){throw"invalid coords"}var c=2*(f[2]);this.setAreaSize(h,this.globalscale*c,this.globalscale*c);this.areas[h].style.left=this.globalscale*(this.pic.offsetLeft+parseInt(f[0],10)-c/2)+"px";this.areas[h].style.top=this.globalscale*(this.pic.offsetTop+parseInt(f[1],10)-c/2)+"px";this._repaint(this.areas[h],this.config.CL_NORM_SHAPE)}else{if(this.areas[h].shape=="poly"||this.areas[h].shape=="bezier1"){if(f.length<2){throw"invalid coords"}this.areas[h].xpoints=[];this.areas[h].ypoints=[];for(var b=0,a=f.length;b<a;b+=2){this.areas[h].xpoints[this.areas[h].xpoints.length]=this.globalscale*(this.pic.offsetLeft+parseInt(f[b],10));this.areas[h].ypoints[this.areas[h].ypoints.length]=this.globalscale*(this.pic.offsetTop+parseInt(f[b+1],10));this._polygongrow(this.areas[h],this.globalscale*f[b],this.globalscale*f[b+1])}this._polygonshrink(this.areas[h])}}}}catch(d){var g=(d.message)?d.message:"error calculating coordinates";this.log(g,1);this.statusMessage(this.strings.ERR_INVALID_COORDS);if(this.areas[h].lastInput){this.fireEvent("onAreaChanged",this.areas[h])}this._repaint(this.areas[h],this.config.CL_NORM_SHAPE);return}this.areas[h].lastInput=e};imgmap.prototype._polygongrow=function(b,g,f){var a=g-parseInt(b.style.left,10);var e=f-parseInt(b.style.top,10);var d=0;var c=0;if(g<parseInt(b.style.left,10)){b.style.left=(g-d)+"px";this.setAreaSize(b.aid,parseInt(b.style.width,10)+Math.abs(a)+c,null)}else{if(g>parseInt(b.style.left,10)+parseInt(b.style.width,10)){this.setAreaSize(b.aid,g-parseInt(b.style.left,10)+c,null)}}if(f<parseInt(b.style.top,10)){b.style.top=(f-d)+"px";this.setAreaSize(b.aid,null,parseInt(b.style.height,10)+Math.abs(e)+c)}else{if(f>parseInt(b.style.top,10)+parseInt(b.style.height,10)){this.setAreaSize(b.aid,null,f-parseInt(b.style.top,10)+c)}}};imgmap.prototype._polygonshrink=function(c){c.style.left=(c.xpoints[0])+"px";c.style.top=(c.ypoints[0])+"px";this.setAreaSize(c.aid,0,0);for(var b=0,a=c.xpoints.length;b<a;b++){this._polygongrow(c,c.xpoints[b],c.ypoints[b])}this._repaint(c,this.config.CL_NORM_SHAPE)};imgmap.prototype.img_mousemove=function(h){var m;var j;var f;var d;var n;if(this.viewmode===1){return}var k=this._getPos(this.pic);m=(this.isMSIE)?(window.event.x-this.pic.offsetLeft):(h.pageX-k.x);j=(this.isMSIE)?(window.event.y-this.pic.offsetTop):(h.pageY-k.y);m=m+this.pic_container.scrollLeft;j=j+this.pic_container.scrollTop;if(m<0||j<0||m>this.pic.width||j>this.pic.height){return}if(this.memory[this.currentid]){var l=this.memory[this.currentid].top;var c=this.memory[this.currentid].left;var o=this.memory[this.currentid].height;var b=this.memory[this.currentid].width}if(this.isSafari){if(h.shiftKey){if(this.is_drawing==this.DM_RECTANGLE_DRAW){this.is_drawing=this.DM_SQUARE_DRAW;this.statusMessage(this.strings.SQUARE2_DRAW)}}else{if(this.is_drawing==this.DM_SQUARE_DRAW&&this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_DRAW;this.statusMessage(this.strings.RECTANGLE_DRAW)}}}if(this.is_drawing==this.DM_RECTANGLE_DRAW){this.fireEvent("onDrawArea",this.currentid);f=m-this.memory[this.currentid].downx;d=j-this.memory[this.currentid].downy;this.setAreaSize(this.currentid,Math.abs(f),Math.abs(d));if(f<0){this.areas[this.currentid].style.left=(m+1)+"px"}if(d<0){this.areas[this.currentid].style.top=(j+1)+"px"}}else{if(this.is_drawing==this.DM_SQUARE_DRAW){this.fireEvent("onDrawArea",this.currentid);f=m-this.memory[this.currentid].downx;d=j-this.memory[this.currentid].downy;if(Math.abs(f)<Math.abs(d)){n=Math.abs(parseInt(f,10))}else{n=Math.abs(parseInt(d,10))}this.setAreaSize(this.currentid,n,n);if(f<0){this.areas[this.currentid].style.left=(this.memory[this.currentid].downx+n*-1)+"px"}if(d<0){this.areas[this.currentid].style.top=(this.memory[this.currentid].downy+n*-1+1)+"px"}}else{if(this.is_drawing==this.DM_POLYGON_DRAW||this.is_drawing==this.DM_BEZIER_DRAW){this.fireEvent("onDrawArea",this.currentid);this._polygongrow(this.areas[this.currentid],m,j)}else{if(this.is_drawing==this.DM_RECTANGLE_MOVE||this.is_drawing==this.DM_SQUARE_MOVE){this.fireEvent("onMoveArea",this.currentid);m=m-this.memory[this.currentid].rdownx;j=j-this.memory[this.currentid].rdowny;if(m+b>this.pic.width||j+o>this.pic.height){return}if(m<0||j<0){return}this.areas[this.currentid].style.left=m+1+"px";this.areas[this.currentid].style.top=j+1+"px"}else{if(this.is_drawing==this.DM_POLYGON_MOVE||this.is_drawing==this.DM_BEZIER_MOVE){this.fireEvent("onMoveArea",this.currentid);m=m-this.memory[this.currentid].rdownx;j=j-this.memory[this.currentid].rdowny;if(m+b>this.pic.width||j+o>this.pic.height){return}if(m<0||j<0){return}f=m-c;d=j-l;if(this.areas[this.currentid].xpoints){for(var g=0,a=this.areas[this.currentid].xpoints.length;g<a;g++){this.areas[this.currentid].xpoints[g]=this.memory[this.currentid].xpoints[g]+f;this.areas[this.currentid].ypoints[g]=this.memory[this.currentid].ypoints[g]+d}}this.areas[this.currentid].style.left=m+"px";this.areas[this.currentid].style.top=j+"px"}else{if(this.is_drawing==this.DM_SQUARE_RESIZE_LEFT){this.fireEvent("onResizeArea",this.currentid);n=m-c;if((b+(-1*n))>0){this.areas[this.currentid].style.left=m+1+"px";this.areas[this.currentid].style.top=(l+(n/2))+"px";this.setAreaSize(this.currentid,parseInt(b+(-1*n),10),parseInt(o+(-1*n),10))}else{this.memory[this.currentid].width=0;this.memory[this.currentid].height=0;this.memory[this.currentid].left=m;this.memory[this.currentid].top=j;this.is_drawing=this.DM_SQUARE_RESIZE_RIGHT}}else{if(this.is_drawing==this.DM_SQUARE_RESIZE_RIGHT){this.fireEvent("onResizeArea",this.currentid);n=m-c-b;if((b+(n))-1>0){this.areas[this.currentid].style.top=(l+(-1*n/2))+"px";this.setAreaSize(this.currentid,(b+(n))-1,(o+(n)))}else{this.memory[this.currentid].width=0;this.memory[this.currentid].height=0;this.memory[this.currentid].left=m;this.memory[this.currentid].top=j;this.is_drawing=this.DM_SQUARE_RESIZE_LEFT}}else{if(this.is_drawing==this.DM_SQUARE_RESIZE_TOP){this.fireEvent("onResizeArea",this.currentid);n=j-l;if((b+(-1*n))>0){this.areas[this.currentid].style.top=j+1+"px";this.areas[this.currentid].style.left=(c+(n/2))+"px";this.setAreaSize(this.currentid,(b+(-1*n)),(o+(-1*n)))}else{this.memory[this.currentid].width=0;this.memory[this.currentid].height=0;this.memory[this.currentid].left=m;this.memory[this.currentid].top=j;this.is_drawing=this.DM_SQUARE_RESIZE_BOTTOM}}else{if(this.is_drawing==this.DM_SQUARE_RESIZE_BOTTOM){this.fireEvent("onResizeArea",this.currentid);n=j-l-o;if((b+(n))-1>0){this.areas[this.currentid].style.left=(c+(-1*n/2))+"px";this.setAreaSize(this.currentid,(b+(n))-1,(o+(n))-1)}else{this.memory[this.currentid].width=0;this.memory[this.currentid].height=0;this.memory[this.currentid].left=m;this.memory[this.currentid].top=j;this.is_drawing=this.DM_SQUARE_RESIZE_TOP}}else{if(this.is_drawing==this.DM_RECTANGLE_RESIZE_LEFT){this.fireEvent("onResizeArea",this.currentid);f=m-c;if(b+(-1*f)>0){this.areas[this.currentid].style.left=m+1+"px";this.setAreaSize(this.currentid,b+(-1*f),null)}else{this.memory[this.currentid].width=0;this.memory[this.currentid].left=m;this.is_drawing=this.DM_RECTANGLE_RESIZE_RIGHT}}else{if(this.is_drawing==this.DM_RECTANGLE_RESIZE_RIGHT){this.fireEvent("onResizeArea",this.currentid);f=m-c-b;if((b+(f))-1>0){this.setAreaSize(this.currentid,(b+(f))-1,null)}else{this.memory[this.currentid].width=0;this.memory[this.currentid].left=m;this.is_drawing=this.DM_RECTANGLE_RESIZE_LEFT}}else{if(this.is_drawing==this.DM_RECTANGLE_RESIZE_TOP){this.fireEvent("onResizeArea",this.currentid);d=j-l;if((o+(-1*d))>0){this.areas[this.currentid].style.top=j+1+"px";this.setAreaSize(this.currentid,null,(o+(-1*d)))}else{this.memory[this.currentid].height=0;this.memory[this.currentid].top=j;this.is_drawing=this.DM_RECTANGLE_RESIZE_BOTTOM}}else{if(this.is_drawing==this.DM_RECTANGLE_RESIZE_BOTTOM){this.fireEvent("onResizeArea",this.currentid);d=j-l-o;if((o+(d))-1>0){this.setAreaSize(this.currentid,null,(o+(d))-1)}else{this.memory[this.currentid].height=0;this.memory[this.currentid].top=j;this.is_drawing=this.DM_RECTANGLE_RESIZE_TOP}}}}}}}}}}}}}}if(this.is_drawing){this._repaint(this.areas[this.currentid],this.config.CL_DRAW_SHAPE,m,j);this._updatecoords(this.currentid)}};imgmap.prototype.img_mouseup=function(b){if(this.viewmode===1){return}var d=this._getPos(this.pic);var a=(this.isMSIE)?(window.event.x-this.pic.offsetLeft):(b.pageX-d.x);var c=(this.isMSIE)?(window.event.y-this.pic.offsetTop):(b.pageY-d.y);a=a+this.pic_container.scrollLeft;c=c+this.pic_container.scrollTop;if(this.is_drawing!=this.DM_RECTANGLE_DRAW&&this.is_drawing!=this.DM_SQUARE_DRAW&&this.is_drawing!=this.DM_POLYGON_DRAW&&this.is_drawing!=this.DM_POLYGON_LASTDRAW&&this.is_drawing!=this.DM_BEZIER_DRAW&&this.is_drawing!=this.DM_BEZIER_LASTDRAW){this.draggedId=null;this.is_drawing=0;this.statusMessage(this.strings.READY);this.relaxArea(this.currentid);if(this.areas[this.currentid]==this._getLastArea()){return}this.memory[this.currentid].downx=a;this.memory[this.currentid].downy=c}};imgmap.prototype.img_mousedown=function(c){if(this.viewmode===1){return}if(!this.areas[this.currentid]&&this.config.mode!="editor2"){return}var f=this._getPos(this.pic);var a=(this.isMSIE)?(window.event.x-this.pic.offsetLeft):(c.pageX-f.x);var d=(this.isMSIE)?(window.event.y-this.pic.offsetTop):(c.pageY-f.y);a=a+this.pic_container.scrollLeft;d=d+this.pic_container.scrollTop;if(!c){c=window.event}if(c.shiftKey){if(this.is_drawing==this.DM_POLYGON_DRAW){this.is_drawing=this.DM_POLYGON_LASTDRAW}else{if(this.is_drawing==this.DM_BEZIER_DRAW){this.is_drawing=this.DM_BEZIER_LASTDRAW}}}if(this.is_drawing==this.DM_POLYGON_DRAW||this.is_drawing==this.DM_BEZIER_DRAW){this.areas[this.currentid].xpoints[this.areas[this.currentid].xpoints.length]=a-5;this.areas[this.currentid].ypoints[this.areas[this.currentid].ypoints.length]=d-5;this.memory[this.currentid].downx=a;this.memory[this.currentid].downy=d;return}else{if(this.is_drawing&&this.is_drawing!=this.DM_POLYGON_DRAW&&this.is_drawing!=this.DM_BEZIER_DRAW){if(this.is_drawing==this.DM_POLYGON_LASTDRAW||this.is_drawing==this.DM_BEZIER_LASTDRAW){this.areas[this.currentid].xpoints[this.areas[this.currentid].xpoints.length]=a-5;this.areas[this.currentid].ypoints[this.areas[this.currentid].ypoints.length]=d-5;this._updatecoords(this.currentid);this.is_drawing=0;this._polygonshrink(this.areas[this.currentid])}this.is_drawing=0;this.statusMessage(this.strings.READY);this.relaxArea(this.currentid);if(this.areas[this.currentid]==this._getLastArea()){if(this.config.mode!="editor2"){this.addNewArea()}return}return}}if(this.config.mode=="editor2"){if(!this.nextShape){return}this.addNewArea();this.initArea(this.currentid,this.nextShape)}else{if(this.areas[this.currentid].shape=="undefined"||this.areas[this.currentid].shape=="poly"){var b=this.nextShape;if(!b){b="rect"}this.initArea(this.currentid,b)}}if(this.areas[this.currentid].shape=="poly"){this.is_drawing=this.DM_POLYGON_DRAW;this.statusMessage(this.strings.POLYGON_DRAW);this.areas[this.currentid].style.left=a+"px";this.areas[this.currentid].style.top=d+"px";this.areas[this.currentid].style.width=0;this.areas[this.currentid].style.height=0;this.areas[this.currentid].xpoints=[];this.areas[this.currentid].ypoints=[];this.areas[this.currentid].xpoints[0]=a;this.areas[this.currentid].ypoints[0]=d}else{if(this.areas[this.currentid].shape=="bezier1"){this.is_drawing=this.DM_BEZIER_DRAW;this.statusMessage(this.strings.BEZIER_DRAW);this.areas[this.currentid].style.left=a+"px";this.areas[this.currentid].style.top=d+"px";this.areas[this.currentid].style.width=0;this.areas[this.currentid].style.height=0;this.areas[this.currentid].xpoints=[];this.areas[this.currentid].ypoints=[];this.areas[this.currentid].xpoints[0]=a;this.areas[this.currentid].ypoints[0]=d}else{if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_DRAW;this.statusMessage(this.strings.RECTANGLE_DRAW);this.areas[this.currentid].style.left=a+"px";this.areas[this.currentid].style.top=d+"px";this.areas[this.currentid].style.width=0;this.areas[this.currentid].style.height=0}else{if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_DRAW;this.statusMessage(this.strings.SQUARE_DRAW);this.areas[this.currentid].style.left=a+"px";this.areas[this.currentid].style.top=d+"px";this.areas[this.currentid].style.width=0;this.areas[this.currentid].style.height=0}}}}this._setBorder(this.currentid,"DRAW");this.memory[this.currentid].downx=a;this.memory[this.currentid].downy=d};imgmap.prototype.highlightArea=function(c,a){if(this.is_drawing){return}if(this.areas[c]&&this.areas[c].shape!="undefined"){this.fireEvent("onFocusArea",this.areas[c]);this._setBorder(c,"HIGHLIGHT");var b=this.config.highlight_opacity;if(a=="grad"){b="-"+b}this._setopacity(this.areas[c],this.config.CL_HIGHLIGHT_BG,b);this._repaint(this.areas[c],this.config.CL_HIGHLIGHT_SHAPE)}};imgmap.prototype.blurArea=function(c,a){if(this.is_drawing){return}if(this.areas[c]&&this.areas[c].shape!="undefined"){this.fireEvent("onBlurArea",this.areas[c]);this._setBorder(c,"NORM");var b=this.config.norm_opacity;if(a=="grad"){b="-"+b}this._setopacity(this.areas[c],this.config.CL_NORM_BG,b);this._repaint(this.areas[c],this.config.CL_NORM_SHAPE)}};imgmap.prototype.area_mousemove=function(h){if(this.viewmode===1){return}if(!this.is_drawing){var g=(this.isMSIE)?window.event.srcElement:h.currentTarget;if(g.tagName=="DIV"){g=g.parentNode}if(g.tagName=="image"||g.tagName=="group"||g.tagName=="shape"||g.tagName=="stroke"){g=g.parentNode.parentNode}if(this.isOpera){h.layerX=h.offsetX;h.layerY=h.offsetY}var a=(this.isMSIE)?(window.event.offsetX):(h.layerX);var f=(this.isMSIE)?(window.event.offsetY):(h.layerY);var d=(g.shape=="rect"||g.shape=="circle");if(d&&a<6&&f>6){g.style.cursor="w-resize"}else{if(d&&a>parseInt(g.style.width,10)-6&&f>6){g.style.cursor="e-resize"}else{if(d&&a>6&&f<6){g.style.cursor="n-resize"}else{if(d&&f>parseInt(g.style.height,10)-6&&a>6){g.style.cursor="s-resize"}else{g.style.cursor="move"}}}}if(g.aid!=this.draggedId){if(g.style.cursor=="move"){g.style.cursor="default"}return}if(a<6&&f>6){if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_RESIZE_LEFT;this.statusMessage(this.strings.SQUARE_RESIZE_LEFT)}else{if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_RESIZE_LEFT;this.statusMessage(this.strings.RECTANGLE_RESIZE_LEFT)}}}else{if(a>parseInt(this.areas[this.currentid].style.width,10)-6&&f>6){if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_RESIZE_RIGHT;this.statusMessage(this.strings.SQUARE_RESIZE_RIGHT)}else{if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_RESIZE_RIGHT;this.statusMessage(this.strings.RECTANGLE_RESIZE_RIGHT)}}}else{if(a>6&&f<6){if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_RESIZE_TOP;this.statusMessage(this.strings.SQUARE_RESIZE_TOP)}else{if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_RESIZE_TOP;this.statusMessage(this.strings.RECTANGLE_RESIZE_TOP)}}}else{if(f>parseInt(this.areas[this.currentid].style.height,10)-6&&a>6){if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_RESIZE_BOTTOM;this.statusMessage(this.strings.SQUARE_RESIZE_BOTTOM)}else{if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_RESIZE_BOTTOM;this.statusMessage(this.strings.RECTANGLE_RESIZE_BOTTOM)}}}else{if(this.areas[this.currentid].shape=="circle"){this.is_drawing=this.DM_SQUARE_MOVE;this.statusMessage(this.strings.SQUARE_MOVE);this.memory[this.currentid].rdownx=a;this.memory[this.currentid].rdowny=f}else{if(this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_MOVE;this.statusMessage(this.strings.RECTANGLE_MOVE);this.memory[this.currentid].rdownx=a;this.memory[this.currentid].rdowny=f}else{if(this.areas[this.currentid].shape=="poly"||this.areas[this.currentid].shape=="bezier1"){if(this.areas[this.currentid].xpoints){for(var c=0,b=this.areas[this.currentid].xpoints.length;c<b;c++){this.memory[this.currentid].xpoints[c]=this.areas[this.currentid].xpoints[c];this.memory[this.currentid].ypoints[c]=this.areas[this.currentid].ypoints[c]}}if(this.areas[this.currentid].shape=="poly"){this.is_drawing=this.DM_POLYGON_MOVE;this.statusMessage(this.strings.POLYGON_MOVE)}else{if(this.areas[this.currentid].shape=="bezier1"){this.is_drawing=this.DM_BEZIER_MOVE;this.statusMessage(this.strings.BEZIER_MOVE)}}this.memory[this.currentid].rdownx=a;this.memory[this.currentid].rdowny=f}}}}}}}this.memory[this.currentid].width=parseInt(this.areas[this.currentid].style.width,10);this.memory[this.currentid].height=parseInt(this.areas[this.currentid].style.height,10);this.memory[this.currentid].top=parseInt(this.areas[this.currentid].style.top,10);this.memory[this.currentid].left=parseInt(this.areas[this.currentid].style.left,10);this._setBorder(this.currentid,"DRAW");this._setopacity(this.areas[this.currentid],this.config.CL_DRAW_BG,this.config.draw_opacity)}else{this.img_mousemove(h)}};imgmap.prototype.area_mouseup=function(b){if(this.viewmode===1){return}if(!this.is_drawing){var a=(this.isMSIE)?window.event.srcElement:b.currentTarget;if(a.tagName=="DIV"){a=a.parentNode}if(a.tagName=="image"||a.tagName=="group"||a.tagName=="shape"||a.tagName=="stroke"){a=a.parentNode.parentNode}if(this.areas[this.currentid]!=a){if(typeof a.aid=="undefined"){this.log("Cannot identify target area",1);return}}this.draggedId=null}else{this.img_mouseup(b)}};imgmap.prototype.area_mouseover=function(b){if(this.viewmode===1&&this.config.mode!=="highlighter_spawn"){return}if(!this.is_drawing){var a=(this.isMSIE)?window.event.srcElement:b.currentTarget;if(a.tagName=="DIV"){a=a.parentNode}if(a.tagName=="image"||a.tagName=="group"||a.tagName=="shape"||a.tagName=="stroke"){a=a.parentNode.parentNode}this.highlightArea(a.aid,"grad")}};imgmap.prototype.area_mouseout=function(b){if(this.viewmode===1&&this.config.mode!=="highlighter_spawn"){return}if(!this.is_drawing){var a=(this.isMSIE)?window.event.srcElement:b.currentTarget;if(a.tagName=="DIV"){a=a.parentNode}if(a.tagName=="image"||a.tagName=="group"||a.tagName=="shape"||a.tagName=="stroke"){a=a.parentNode.parentNode}this.blurArea(a.aid,"grad")}};imgmap.prototype.area_dblclick=function(b){if(this.viewmode===1){return}if(!this.is_drawing){var a=(this.isMSIE)?window.event.srcElement:b.currentTarget;if(a.tagName=="DIV"){a=a.parentNode}if(a.tagName=="image"||a.tagName=="group"||a.tagName=="shape"||a.tagName=="stroke"){a=a.parentNode.parentNode}if(this.areas[this.currentid]!=a){if(typeof a.aid=="undefined"){this.log("Cannot identify target area",1);return}this.currentid=a.aid}this.fireEvent("onDblClickArea",this.areas[this.currentid]);if(this.isMSIE){window.event.cancelBubble=true}else{b.stopPropagation()}}};imgmap.prototype.area_mousedown=function(b){if(this.viewmode===1&&this.config.mode!=="highlighter_spawn"){return}if(!this.is_drawing){var a=(this.isMSIE)?window.event.srcElement:b.currentTarget;if(a.tagName=="DIV"){a=a.parentNode}if(a.tagName=="image"||a.tagName=="group"||a.tagName=="shape"||a.tagName=="stroke"){a=a.parentNode.parentNode}if(this.areas[this.currentid]!=a){if(typeof a.aid=="undefined"){this.log("Cannot identify target area",1);return}this.currentid=a.aid}this.draggedId=this.currentid;this.selectedId=this.currentid;this.fireEvent("onSelectArea",this.areas[this.currentid]);if(this.isMSIE){window.event.cancelBubble=true}else{b.stopPropagation()}}else{this.img_mousedown(b)}};imgmap.prototype.doc_keydown=function(b){if(this.viewmode===1){return}var a=(this.isMSIE)?event.keyCode:b.keyCode;if(a==46){if(this.selectedId!==null&&!this.is_drawing){this.removeArea(this.selectedId)}}else{if(a==16){if(this.is_drawing==this.DM_RECTANGLE_DRAW){this.is_drawing=this.DM_SQUARE_DRAW;this.statusMessage(this.strings.SQUARE2_DRAW)}}}};imgmap.prototype.doc_keyup=function(b){var a=(this.isMSIE)?event.keyCode:b.keyCode;if(a==16){if(this.is_drawing==this.DM_SQUARE_DRAW&&this.areas[this.currentid].shape=="rect"){this.is_drawing=this.DM_RECTANGLE_DRAW;this.statusMessage(this.strings.RECTANGLE_DRAW)}}};imgmap.prototype.doc_mousedown=function(a){if(this.viewmode===1){return}if(!this.is_drawing){this.selectedId=null}};imgmap.prototype._getPos=function(b){var a=0;var d=0;if(b){var c=b.offsetParent;if(c){while((c=b.offsetParent)){if(b.offsetLeft>0){a+=b.offsetLeft}if(b.offsetTop>0){d+=b.offsetTop}b=c}}else{a=b.offsetLeft;d=b.offsetTop}}return{x:a,y:d}};imgmap.prototype._getLastArea=function(){for(var a=this.areas.length-1;a>=0;a--){if(this.areas[a]){return this.areas[a]}}return null};imgmap.prototype.assignCSS=function(g,d){var f=d.split(";");for(var c=0;c<f.length;c++){var e=f[c].split(":");var a=this.trim(e[0]).split("-");var h=a[0];for(var b=1;b<a.length;b++){h+=a[b].replace(/^\w/,a[b].substring(0,1).toUpperCase())}g.style[this.trim(h)]=this.trim(e[1])}};imgmap.prototype.fireEvent=function(a,b){if(typeof this.config.custom_callbacks[a]=="function"){return this.config.custom_callbacks[a](b)}};imgmap.prototype.setAreaSize=function(c,a,b){if(c===null){c=this.currentid}if(a!==null){this.areas[c].width=a;this.areas[c].style.width=(a)+"px";this.areas[c].setAttribute("width",a)}if(b!==null){this.areas[c].height=b;this.areas[c].style.height=(b)+"px";this.areas[c].setAttribute("height",b)}};imgmap.prototype.detectLanguage=function(){var a;if(navigator.userLanguage){a=navigator.userLanguage.toLowerCase()}else{if(navigator.language){a=navigator.language.toLowerCase()}else{return this.config.defaultLang}}if(a.length>=2){a=a.substring(0,2);return a}return this.config.defaultLang};imgmap.prototype.disableSelection=function(a){if(typeof a=="undefined"||!a){return false}if(typeof a.onselectstart!="undefined"){a.onselectstart=function(){return false}}if(typeof a.unselectable!="undefined"){a.unselectable="on"}if(typeof a.style.MozUserSelect!="undefined"){a.style.MozUserSelect="none"}};Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}};imgmap.prototype.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};function imgmap_spawnObjects(c){var h=document.getElementsByTagName("map");var f=document.getElementsByTagName("img");var g=[];var k;for(var e=0,a=h.length;e<a;e++){for(var d=0,b=f.length;d<b;d++){if("#"+h[e].name==f[d].getAttribute("usemap")){c.mode="highlighter_spawn";k=new imgmap(c);k.useImage(f[d]);k.setMapHTML(h[e]);k.viewmode=1;g.push(k)}}}};