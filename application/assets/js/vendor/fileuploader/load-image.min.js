(function(b){var c=function(g,i,f){var e,h,d=document.createElement("img");return d.onerror=i,d.onload=function(){!h||f&&f.noRevoke||c.revokeObjectURL(h),i(c.scale(d,f))},window.Blob&&g instanceof Blob||window.File&&g instanceof File?(e=h=c.createObjectURL(g),d._type=g.type):e=g,e?(d.src=e,d):c.readFile(g,function(k){var j=k.target;j&&j.result?d.src=j.result:i(k)})},a=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;c.detectSubsampling=function(f){var g,d,e=f.width,h=f.height;return e*h>1048576?(g=document.createElement("canvas"),g.width=g.height=1,d=g.getContext("2d"),d.drawImage(f,-e+1,0),0===d.getImageData(0,0,1,1).data[3]):!1},c.detectVerticalSquash=function(g,l){var f,i,h,j,e,d=document.createElement("canvas"),k=d.getContext("2d");for(d.width=1,d.height=l,k.drawImage(g,0,0),f=k.getImageData(0,0,1,l).data,i=0,h=l,j=l;j>i;){e=f[4*(j-1)+3],0===e?h=j:i=j,j=h+i>>1}return j/l||1},c.renderImageToCanvas=function(i,g,f,q){var k,p,e,l,u,t,o,m,h=i.width,s=i.height,r=g.getContext("2d"),j=1024,n=document.createElement("canvas");for(r.save(),c.detectSubsampling(i)&&(h/=2,s/=2),k=c.detectVerticalSquash(i,s),n.width=n.height=j,p=n.getContext("2d"),e=Math.ceil(j*f/h),l=Math.ceil(j*q/s/k),t=0,m=0;s>m;){for(u=0,o=0;h>o;){p.clearRect(0,0,j,j),p.drawImage(i,-o,-m),r.drawImage(n,0,0,j,j,u,t,e,l),o+=j,u+=e}m+=j,t+=l}r.restore(),n=p=null},c.scale=function(e,g){g=g||{};var f=document.createElement("canvas"),h=e.width,d=e.height,i=Math.max((g.minWidth||h)/h,(g.minHeight||d)/d);return i>1&&(h=h*i<<0,d=d*i<<0),i=Math.min((g.maxWidth||h)/h,(g.maxHeight||d)/d),1>i&&(h=h*i<<0,d=d*i<<0),e.getContext||g.canvas&&f.getContext?(f.width=h,f.height=d,"image/jpeg"===e._type?c.renderImageToCanvas(e,f,h,d):f.getContext("2d").drawImage(e,0,0,h,d),f):(e.width=h,e.height=d,e)},c.createObjectURL=function(d){return a?a.createObjectURL(d):!1},c.revokeObjectURL=function(d){return a?a.revokeObjectURL(d):!1},c.readFile=function(e,f){if(window.FileReader&&FileReader.prototype.readAsDataURL){var d=new FileReader;return d.onload=d.onerror=f,d.readAsDataURL(e),d}return !1},"function"==typeof define&&define.amd?define(function(){return c}):b.loadImage=c})(this);