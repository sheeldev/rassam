function do_upload(){var e={};var b=0;var c=0;var f=0;var h=0;var j=0;var a=1;var l="itemphoto";var g="";var d=false;if(parent.top.jQuery("#fee13").length){d=true}if(jQuery("#project_id")){h=jQuery("#project_id").val()}if(jQuery("#attachtype")){l=jQuery("#attachtype").val()}if(jQuery("#maxfiles")){a=parseInt(jQuery("#maxfiles").val())}if(jQuery("#ajaxurl")){g=jQuery("#ajaxurl").val()}if(jQuery("#freefiles")){f=parseInt(jQuery("#freefiles").val())}if(jQuery("#costperupload")){j=parseFloat(jQuery("#costperupload").val())}jQuery("#fileupload").fileupload({maxNumberOfFiles:a,url:g+"?do=fileuploader&rfpid="+h+"&attachtype="+l+"&update="+d,autoUpload:true,acceptFileTypes:/(\.|\/)(gif|jpe?g|png|bmp|tif|tiff)$/i}).bind("fileuploadstart",function(){if(parent.top.jQuery("#submit").length){parent.top.jQuery("#submit").prop("disabled",true)}if(parent.top.jQuery("#saveasdraft").length){parent.top.jQuery("#saveasdraft").prop("disabled",true)}parent.top.jQuery.growl.notice({title:phrase._uploading,message:phrase._your_upload_in_progress,duration:5000})}).bind("fileuploadprogressall",function(n,m){if(m.loaded==m.total){if(parent.top.jQuery("#submit").length){parent.top.jQuery("#submit").prop("disabled",false)}if(parent.top.jQuery("#saveasdraft").length){parent.top.jQuery("#saveasdraft").prop("disabled",false)}parent.top.jQuery.growl.notice({title:phrase._upload_complete,message:phrase._your_upload_has_been_completed,duration:5000})}}).bind("fileuploaddestroy",function(n,m){if(m.filehash!=undefined||m.filehash!=NaN||m.filehash!=""){if(parent.top.jQuery("#filtered_auctiontype").val()=="fixed"&&parent.top.jQuery("#variants_1").is(":checked")){if(parent.top.jQuery("#table-variants").contents().find("img."+m.filehash).prop("class")===m.filehash){parent.top.jQuery("#table-variants").contents().find("img."+m.filehash).attr("src",parent.top.iL.BASEURL+"application/assets/images/v5/img_nophoto.gif");parent.top.jQuery.growl.warning({title:phrase._warning,message:phrase._the_pic_was_assoc_one_more_variants,duration:10000});parent.top.smoothscroll("formatfixedprice")}}}}).bind("fileuploaddestroyed",function(o,m){if(d){jQuery.ajax({url:jQuery("#fileupload").fileupload("option","url"),dataType:"json",context:jQuery("#fileupload")[0]}).done(function(p){var s=p.files.length;var r=0;var t=0;for(var q=0;q<s;q++){if(p.files[q].invoiceid>0||p.files[q].invoiceid==="-1"){r++}else{t++}}parent.top.jQuery("#fee12").attr("feetitle",phrase._pictures+" x "+r);parent.top.jQuery("#fee12").attr("uploadcount",r);parent.top.jQuery("#fee13").attr("feetitle",phrase._pictures+" x "+t);parent.top.jQuery("#fee13").attr("uploadcount",t);parent.top.jQuery("#fee13").attr("totaluploadcount",(t+r));if(r<f){parent.top.jQuery("#fee13").attr("fee",((t>0)?parseFloat(j*(t-f)).toFixed(2):"0.00"))}else{parent.top.jQuery("#fee13").attr("fee",((t>0)?parseFloat(j*t).toFixed(2):"0.00"))}jQuery("#uploadscount").html(+t+ +r);jQuery("#totaluploadscount").html(+a);jQuery("#totaluploadsleft").html(+a-(+t+ +r));parent.livefeecalculator()})}else{var n=+parent.top.jQuery("#fee12").attr("uploadcount");n--;if(n<0){n=0}parent.top.jQuery("#fee12").attr("fee",((n>0)?parseFloat(j*(n-f)).toFixed(2):"0.00"));parent.top.jQuery("#fee12").attr("feetitle",phrase._pictures+" x "+n);parent.top.jQuery("#fee12").attr("uploadcount",n);jQuery("#uploadscount").html(+n+ +c);jQuery("#totaluploadscount").html(+a);jQuery("#totaluploadsleft").html(+a-(+n+ +c));parent.livefeecalculator()}jQuery("#itempictures").trigger("sortupdate");parent.top.jQuery.growl.notice({title:phrase._success,message:phrase._the_picture_was_deleted_successfully})}).bind("fileuploaddone",function(r,p){if(d){var o=+parent.top.jQuery("#fee12").attr("uploadcount");var q=+parent.top.jQuery("#fee13").attr("uploadcount")+1;var n=p.result.files.length;for(var m=0;m<n;m++){if(p.result.files[m].error===""){}else{q--;if(q<0){q=0}}}if(q>0){parent.top.jQuery("#fee13").attr("fee",parseFloat(j*(q-((o<=0)?f:0))).toFixed(2));parent.top.jQuery("#fee13").attr("feetitle",phrase._pictures+" x "+q);parent.top.jQuery("#fee13").attr("uploadcount",q);parent.top.jQuery("#fee13").attr("totaluploadcount",+q+ +o)}}else{var o=0;var q=+parent.top.jQuery("#fee12").attr("uploadcount")+1;var n=p.result.files.length;for(var m=0;m<n;m++){if(p.result.files[m].error===""){}else{q--;if(q<0){q=0}}}if(q>0){parent.top.jQuery("#fee12").attr("fee",parseFloat(j*(q-f)).toFixed(2));parent.top.jQuery("#fee12").attr("feetitle",phrase._pictures+" x "+q);parent.top.jQuery("#fee12").attr("uploadcount",q)}}jQuery("#uploadscount").html(+q+ +o);jQuery("#totaluploadscount").html(+a);jQuery("#totaluploadsleft").html(+a-(+q+ +o));jQuery("#itempictures").trigger("sortupdate");parent.livefeecalculator();if(parent.jQuery("#picturesurl").hasClass("open")){if(parent.jQuery("#pictureurls").val()!=""){parent.jQuery("#pictureurls").val("")}parent.jQuery("#picturesurl").removeClass("open");parent.jQuery("#picturesurlbutton").prop("disabled",false);parent.jQuery("#picturesurlbutton").removeClass("disabled");parent.jQuery("#cancelpicturesurl").addClass("hide")}});jQuery.ajax({url:jQuery("#fileupload").fileupload("option","url"),dataType:"json",context:jQuery("#fileupload")[0]}).done(function(m){if(d){var o=m.files.length;for(var n=0;n<o;n++){if(m.files[n].invoiceid>0||m.files[n].invoiceid==="-1"){c++}else{b++}}parent.top.jQuery("#fee12").attr("feetitle",phrase._pictures+" x "+c);parent.top.jQuery("#fee12").attr("uploadcount",c);if(c<f){parent.top.jQuery("#fee13").attr("fee",parseFloat(j*(b-f)).toFixed(2))}else{parent.top.jQuery("#fee13").attr("fee",parseFloat(j*b).toFixed(2))}parent.top.jQuery("#fee13").attr("feetitle",phrase._pictures+" x "+b);parent.top.jQuery("#fee13").attr("uploadcount",b);parent.top.jQuery("#fee13").attr("totaluploadcount",+b+ +c)}else{b=+m.files.length;if(b<0){b=0}if(b>0){parent.top.jQuery("#fee12").attr("fee",parseFloat(j*(b-f)).toFixed(2));parent.top.jQuery("#fee12").attr("feetitle",phrase._pictures+" x "+b);parent.top.jQuery("#fee12").attr("uploadcount",b)}}jQuery("#uploadscount").html(+b+ +c);jQuery("#totaluploadscount").html(+a);jQuery("#totaluploadsleft").html(+a-(+b+ +c));jQuery("#itempictures").trigger("sortupdate");parent.livefeecalculator();jQuery(this).fileupload("option","done").call(this,null,{result:m})});function k(){var m=1;jQuery("#itempictures li").each(function(){jQuery(this).find("input[type=hidden]:first").val(m);m++})}function i(){jQuery.ajax({type:"POST",url:g+"?do=fileuploadreorder",data:jQuery("#itempictures").sortable("serialize")})}jQuery("#itempictures").sortable({delay:100,items:"li",opacity:0.7,axis:"x",update:function(m,n){k()},stop:function(m,n){i()}});jQuery("#itempictures").on("sortupdate",function(m,n){k()});jQuery("#itempictures").on("sortstop",function(m,n){i()})}function cancel_save_pictures_via_url(){parent.jQuery("#picturesurlbutton").prop("disabled",false);parent.jQuery("#picturesurlbutton").removeClass("disabled");parent.jQuery("#cancelpicturesurl").addClass("hide")}function save_pictures_via_url(){var b=parent.jQuery("#pictureurls").val().split("\n");if(b){var a=b.length;if(b.length>25){a=25}if(parent.jQuery("#pictureurls").val()!=""){parent.jQuery("#picturesurlbutton").prop("disabled",true);parent.jQuery("#picturesurlbutton").addClass("disabled");parent.jQuery("#cancelpicturesurl").removeClass("hide")}for(var c=0;c<a;c++){$.getImageData({url:b[c],server_url:parent.top.iL.AJAXURL+"?do=fileuploadviaurl",success:function(d){var e=document.createElement("canvas");e.width=d.width;e.height=d.height;if(e.getContext&&e.toBlob){e.getContext("2d").drawImage(d,0,0,d.width,d.height);e.toBlob(function(f){if(!f.name){f.name=d.filename}parent.jQuery.growl.notice({title:phrase._success,message:phrase._assigning_x_to_your_listing.replace("[x]",d.filename)});jQuery("#fileupload").fileupload("add",{files:[f]})},d.mime)}},error:function(e,d){parent.jQuery.growl.error({title:phrase._error,message:phrase._invalid_image_or_url});parent.jQuery("#picturesurlbutton").prop("disabled",false);parent.jQuery("#picturesurlbutton").removeClass("disabled");parent.jQuery("#cancelpicturesurl").addClass("hide")}})}parent.jQuery("#pictureurls").val("");parent.jQuery("#picturesurlbutton").prop("disabled",false);parent.jQuery("#picturesurlbutton").removeClass("disabled");parent.jQuery("#cancelpicturesurl").addClass("hide")}}$(function(){do_upload()});