(function(a){a.fn.inputTags=function(c){if(!("inputTags" in window)){window.inputTags={instances:[]}}window.inputTags.methods={tags:function(h,l){if(h){switch(typeof h){case"string":switch(h){case"_toString":var k=b.tags.toString();if(l){return l(k)}return k;break;case"_toObject":var j=b._toObject(b.tags);if(l){return l(j)}return j;break;case"_toJSON":var j=b._toObject(b.tags);var g=JSON.stringify(j);if(l){return l(g)}return g;break;case"_toArray":if(l){return l(b.tags)}return b.tags;break}var f=h.split(",");if(f.length>1){var i=b.tags;b.tags=i.concat(f)}else{b.tags.push(f[0])}break;case"object":var i=b.tags;if("[object Object]"===Object.prototype.toString.call(h)){h=Object.keys(h).map(function(m){return h[m]})}b.tags=i.concat(h);break;case"function":return h(b.tags);break}b._clean();b._fill();b._updateValue();b.destroy();b._setInstance(b);if(l){return l(b.tags)}}return b.tags},event:function(g,f){b.options[g]=f;b._setInstance(b)},options:function(f,g){if(!f&&!g){return b.options}if(g){b.options[f]=g;b._setInstance(b)}else{return b.options[f]}},destroy:function(){var f=a(this).attr("data-uniqid");delete window.inputTags.instances[f]}};if("object"===typeof c||!c){var c=a.extend(true,{},a.fn.inputTags.defaults,c);var d=this.each(function(){var f=a(this);f.UNIQID=Math.round(Date.now()/(Math.random()*(548-54)-54));f.DEFAULT_CLASS="inputTags";f.ELEMENT_CLASS=f.DEFAULT_CLASS+"-"+f.UNIQID;f.LIST_CLASS=f.DEFAULT_CLASS+"-list";f.ITEM_CLASS=f.DEFAULT_CLASS+"-item";f.ITEM_CONTENT='<span class="value" title="Click to edit">%s</span><i class="close-item">&times</i>';f.FIELD_CLASS=f.DEFAULT_CLASS+"-field";f.ERROR_CLASS=f.DEFAULT_CLASS+"-error";f.ERROR_CONTENT='<p class="'+f.ERROR_CLASS+'">%s</p>';f.AUTOCOMPLETE_LIST_CLASS=f.DEFAULT_CLASS+"-autocomplete-list";f.AUTOCOMPLETE_ITEM_CLASS=f.DEFAULT_CLASS+"-autocomplete-item";f.AUTOCOMPLETE_ITEM_CONTENT='<li class="'+f.AUTOCOMPLETE_ITEM_CLASS+'">%s</li>';f.options=c;f.keys=[13,188,27];f.tags=[];if(f.options.keys.length>0){f.keys=f.keys.concat(f.options.keys)}f.init=function(){f.addClass(f.ELEMENT_CLASS).attr("data-uniqid",f.UNIQID);f.$element=a("."+f.ELEMENT_CLASS);f.$element.hide();f.build();f.fill();f.save();f.edit();f.destroy();f._autocomplete()._init();f._focus()};f.build=function(){f.$html=a("<div>").addClass(f.LIST_CLASS);f.$input=a("<input>").attr({type:"text","class":f.FIELD_CLASS});f.$html.insertAfter(f.$element).prepend(f.$input);f.$list=f.$element.next("."+f.LIST_CLASS);f.$list.on("click",function(g){if(a(g.target).hasClass("inputTags-field")){return false}f.$input.focus()})};f.fill=function(){f._getDefaultValues();if(0===f.options.tags){return false}f._concatenate();f._updateValue();f._fill()};f._fill=function(){f.tags.forEach(function(h,g){var j=f._validate(h,false);if(true===j||("max"===j&&g+1<=f.options.max)){f._buildItem(h)}})};f._clean=function(){a("."+f.ITEM_CLASS,f.$list).remove()};f.save=function(){f.$input.on("keyup",function(k){k.preventDefault();var i=k.keyCode||k.which;var j=f.$input.val().trim();if(a.inArray(i,f.keys)<0){return false}if(27===i){f._cancel();return false}j=188===i?j.slice(0,-1):j;if(!f._validate(j,true)){return false}if(f.options.only&&f._exists(j)){f._errors("exists");return false}if(f.$input.hasClass("is-edit")){var h=f.$input.attr("data-old-value");if(h===j){f._cancel();return true}f._update(h,j);f._clean();f._fill()}else{if(f._autocomplete()._isSet()&&f._autocomplete()._get("only")){if(a.inArray(j,f._autocomplete()._get("values"))<0){f._autocomplete()._hide();f._errors("autocomplete_only");return false}}if(f._exists(j)){f.$input.removeClass("is-autocomplete");f._errors("exists");var g=a('[data-tag="'+j+'"]',f.$list);g.addClass("is-exists");setTimeout(function(){g.removeClass("is-exists")},300);return false}f._buildItem(j);f._insert(j)}f._cancel();f._updateValue();f.destroy();f._autocomplete()._build();f._setInstance(f);f.$input.focus();return false})};f.edit=function(){f.$list.on("click","."+f.ITEM_CLASS,function(i){if(a(i.target).hasClass("close-item")||false===f.options.editable||(f._autocomplete()._isSet()&&f._autocomplete()._get("only"))){f._cancel();return true}var g=a(this).addClass("is-edit");var h=a(".value",g).text();f.$input.width(g.outerWidth()).insertAfter(g).addClass("is-edit").attr("data-old-value",h).val(h).focus();f._bindEvent("selected");f.$input.on("blur",function(){f._cancel();f._bindEvent("unselected")})})};f.destroy=function(){a("."+f.ITEM_CLASS,f.$list).off("click").on("click",".close-item",function(){var g=a(this).parent("."+f.ITEM_CLASS);var h=a(".value",g).text();g.addClass("is-closed");setTimeout(function(){f._pop(h);f._updateValue();g.remove();f._autocomplete()._build();f.$input.focus();f._setInstance(f)},200)})};f._buildItem=function(i){var h=a(f.ITEM_CONTENT.replace("%s",i));var g=a("<span>").addClass(f.ITEM_CLASS+" is-closed").attr("data-tag",i).html(h);g.insertBefore(f.$input).delay(100).queue(function(){a(this).removeClass("is-closed")})};f._getIndex=function(g){return f.tags.indexOf(g)};f._concatenate=function(){if(!"boolean"===typeof f.options.max||f.options.max>0){if(f.options.tags.length>f.options.max){f.options.tags.splice(-Math.abs(f.options.tags.length-f.options.max))}}f.tags=f.tags.concat(f.options.tags)};f._getDefaultValues=function(){if(f.$element.val().length>0){f.tags=f.tags.concat(f.$element.val().split(","))}else{f.$element.attr("value","")}};f._insert=function(g){f.tags.push(g);f._bindEvent(["change","create"])};f._update=function(g,i){var h=f._getIndex(g);f.tags[h]=i;f._bindEvent(["change","update"])};f._pop=function(h){var g=f._getIndex(h);if(g<0){return false}f.tags.splice(g,1);f._bindEvent(["change","destroy"])};f._cancel=function(){a("."+f.ITEM_CLASS).removeClass("is-edit");f.$input.removeClass("is-edit is-autocomplete").removeAttr("data-old-value style").val("").appendTo(f.$list)};f._autocomplete=function(){var g=f.options.autocomplete.values;return{_isSet:function(){return g.length>0},_init:function(){if(!f._autocomplete()._isSet()){return false}f._autocomplete()._build()},_build:function(){if(f._autocomplete()._exists()){f.$autocomplete.remove()}f.$autocomplete=a("<ul>").addClass(f.AUTOCOMPLETE_LIST_CLASS);f._autocomplete()._get("values").forEach(function(l,j){var h=f.AUTOCOMPLETE_ITEM_CONTENT.replace("%s",l);var i=a.inArray(l,f.tags)>=0?a(h).addClass("is-disabled"):a(h);i.appendTo(f.$autocomplete)});f._autocomplete()._bindClick();a(document).not(f.$autocomplete).on("click",function(){f._autocomplete()._hide()})},_bindClick:function(){a(f.$autocomplete).off("click").on("click","."+f.AUTOCOMPLETE_ITEM_CLASS,function(h){if(a(h.target).hasClass("is-disabled")){return false}f.$input.addClass("is-autocomplete").val(a(this).text());f._autocomplete()._hide();f._bindEvent("autocompleteTagSelect");var h=a.Event("keyup");h.which=13;f.$input.trigger(h)})},_show:function(){if(!f._autocomplete()._isSet()){return false}f.$autocomplete.css({left:f.$input[0].offsetLeft,minWidth:f.$input.width()}).insertAfter(f.$input);setTimeout(function(){f._autocomplete()._bindClick();f.$autocomplete.addClass("is-active")},100)},_hide:function(){f.$autocomplete.removeClass("is-active")},_get:function(h){return f.options.autocomplete[h]},_exists:function(){return undefined!==f.$autocomplete}}};f._updateValue=function(){f.$element.attr("value",f.tags.join(","))};f._focus=function(){f.$input.on("focus",function(){f._bindEvent("focus");if(f._autocomplete()._isSet()&&!f.$input.hasClass("is-autocomplete")&&!f.$input.hasClass("is-edit")){f._autocomplete()._show()}})};f._toObject=function(g){return g.reduce(function(k,h,j){k[j]=h;return k},{})};f._validate=function(i,j){var h="",g;switch(true){case !i:case undefined===i:case 0===i.length:f._cancel();h="empty";break;case i.length>0&&i.length<f.options.minLength:h="minLength";break;case i.length>f.options.maxLength:h="maxLength";break;case f.options.max>0&&f.tags.length>=f.options.max:if(!f.$input.hasClass("is-edit")){h="max"}break;case f.options.email:g=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!g.test(i)){h="email"}break}if(h.length>0){return j?f._errors(h):h}return true};f._exists=function(g){return a.inArray(g,f.tags)>=0};f._errors=function(g){if(0===g.length){return false}if(f._autocomplete()._exists()){f.$autocomplete.remove()}f._displayErrors(f.options.errors[g].replace("%s",f.options[g]),g);return false};f._displayErrors=function(h,i){var g=a(f.ERROR_CONTENT.replace("%s",h)).attr("data-error",i);var j=f.options.errors.timeout;if(a("."+f.ERROR_CLASS+'[data-error="'+i+'"]').length){return false}g.hide().insertAfter(f.$list).slideDown();if(!j||j<=0){return false}a("."+f.ERROR_CLASS).on("click",function(){f._collapseErrors(a(this))});setTimeout(function(){f._collapseErrors()},j)};f._collapseErrors=function(g){var h=g?g:a("."+f.ERROR_CLASS);h.slideUp(300,function(){h.remove()})};f._getInstance=function(){return window.inputTags.instances[f.UNIQID]};f._setInstance=function(g){window.inputTags.instances[f.UNIQID]=f};f._isSet=function(g){return undefined===f.options[g]||false===f.options[g]||f.options[g].length<=0?false:true};f._callMethod=function(h,g){if(undefined===g.options[h]||"function"!==typeof g.options[h]){return false}g.options[h].apply(this,Array.prototype.slice.call(arguments,1))};f._initEvent=function(h,g){if(!h){return false}switch(typeof h){case"string":g(h,f);break;case"object":h.forEach(function(j,k){g(j,f)});break}return true};f._bindEvent=function(g){return f._initEvent(g,function(h,i){f._callMethod(h,i)})};f._unbindEvent=function(g){return f._initEvent(g,function(h,i){f.options[h]=false})};f.init();f._bindEvent("init");f._setInstance(f)});return{on:function(g,f){window.inputTags.methods.event(g,f)}}}else{if(window.inputTags.methods[c]){var e=a(this).attr("data-uniqid");var b=window.inputTags.instances[e];if(undefined===b){return a.error("[undefined instance] No inputTags instance found.")}return window.inputTags.methods[c].apply(this,Array.prototype.slice.call(arguments,1))}else{a.error("[undefined method] The method ["+c+"] does not exists.")}}};a.fn.inputTags.defaults={tags:[],keys:[],minLength:2,maxLength:30,max:6,email:false,only:true,init:false,create:false,update:false,destroy:false,focus:false,selected:false,unselected:false,change:false,autocompleteTagSelect:false,editable:true,autocomplete:{values:[],only:false},errors:{empty:"Warning, you can not add an empty tag.",minLength:"Warning, your tag must have at least %s characters.",maxLength:"Be careful, your tag must not exceed %s characters.",max:"Warning, the number of tags must not exceed %s.",email:"Warning, the email address you entered is not valid.",exists:"Warning, this tag already exists!",autocomplete_only:"Warning, you must select a value from the list.",timeout:8000}}})(jQuery);